<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News DC - Premium Sohbet</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #5865f2;
            --primary-dark: #4752c4;
            --secondary: #3f37c9;
            --accent: #5865f2;
            --light: #f8f9fa;
            --dark: #dcddde;
            --gray: #b9bbbe;
            --success: #3ba55c;
            --danger: #ed4245;
            --warning: #faa61a;
            --info: #5865f2;
            --card-bg: #36393f;
            --card-shadow: 0 2px 10px 0 rgba(0, 0, 0, 0.2);
            
            /* Dark mode variables */
            --dark-bg: #36393f;
            --dark-card-bg: #2f3136;
            --dark-text: #dcddde;
            --dark-border: #202225;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            background-color: #36393f;
            color: var(--dark);
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        /* Auth Container */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #36393f;
            padding: 20px;
        }
        
        .auth-card {
            background-color: var(--card-bg);
            border-radius: 8px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .auth-card {
            background-color: var(--dark-card-bg);
        }
        
        .auth-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .auth-header::after {
            content: '';
            position: absolute;
            bottom: -50px;
            left: 0;
            width: 100%;
            height: 60px;
            background-color: var(--card-bg);
            border-radius: 8px 8px 0 0;
        }
        
        .dark-mode .auth-header::after {
            background-color: var(--dark-card-bg);
        }
        
        .auth-logo {
            width: 80px;
            height: 80px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 15px;
            color: var(--primary);
            font-size: 32px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        
        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--dark-border);
        }
        
        .dark-mode .auth-tabs {
            border-bottom-color: var(--dark-border);
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.3s;
            position: relative;
        }
        
        .dark-mode .auth-tab {
            color: #b9bbbe;
        }
        
        .auth-tab.active {
            color: white;
            font-weight: 600;
        }
        
        .dark-mode .auth-tab.active {
            color: white;
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .dark-mode .auth-tab.active::after {
            background-color: var(--accent);
        }
        
        .auth-content {
            padding: 20px;
        }
        
        .auth-form {
            display: none;
            animation: slideUp 0.4s ease;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .dark-mode .form-group label {
            color: var(--dark-text);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
            background-color: var(--dark-border);
            color: var(--dark);
        }
        
        .dark-mode .form-control {
            background-color: var(--dark-border);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(88, 101, 242, 0.3);
        }
        
        .dark-mode .form-control:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(88, 101, 242, 0.3);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .btn-google {
            background-color: #4285F4;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-google:hover {
            background-color: #357ABD;
        }
        
        .btn-google i {
            background-color: white;
            color: #4285F4;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .error-message {
            background-color: rgba(237, 66, 69, 0.1);
            color: var(--danger);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .dark-mode .error-message {
            background-color: rgba(237, 66, 69, 0.2);
        }
        
        .error-message i {
            margin-right: 10px;
        }
        
        .success-message {
            background-color: rgba(59, 165, 92, 0.1);
            color: var(--success);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            animation: fadeIn 0.3s;
        }
        
        .dark-mode .success-message {
            background-color: rgba(59, 165, 92, 0.2);
        }
        
        .success-message i {
            margin-right: 10px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray);
            font-size: 14px;
        }
        
        .dark-mode .divider {
            color: #b9bbbe;
        }
        
        .divider::before, .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background-color: var(--dark-border);
            margin: 0 10px;
        }
        
        .dark-mode .divider::before,
        .dark-mode .divider::after {
            background-color: var(--dark-border);
        }

        /* App Container Styles */
        #appContainer {
            display: none;
            min-height: 100vh;
            background-color: var(--dark-bg);
        }
        
        .dark-mode #appContainer {
            background-color: var(--dark-bg);
        }

        .app-header {
            background: var(--dark-card-bg);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 0 rgba(4, 4, 5, 0.2), 0 1.5px 0 rgba(6, 6, 7, 0.05), 0 2px 0 rgba(4, 4, 5, 0.05);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .dark-mode .app-header {
            box-shadow: 0 1px 0 rgba(4, 4, 5, 0.2), 0 1.5px 0 rgba(6, 6, 7, 0.05), 0 2px 0 rgba(4, 4, 5, 0.05);
        }

        .app-logo {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 18px;
        }

        .app-logo i {
            margin-right: 10px;
            font-size: 24px;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #5865f2;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 50px;
            background-color: var(--dark-card-bg);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 200px;
            overflow: hidden;
            display: none;
            z-index: 1001;
            border: 1px solid var(--dark-border);
        }
        
        .dark-mode .dropdown-menu {
            background-color: var(--dark-card-bg);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .dropdown-menu.show {
            display: block;
            animation: slideUp 0.3s ease;
        }

        .dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            color: var(--dark-text);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark-mode .dropdown-item {
            color: var(--dark-text);
        }

        .dropdown-item i {
            margin-right: 10px;
            color: var(--gray);
        }

        .dropdown-item:hover {
            background-color: rgba(79, 84, 92, 0.4);
            color: white;
        }
        
        .dark-mode .dropdown-item:hover {
            background-color: rgba(79, 84, 92, 0.4);
            color: white;
        }

        .dropdown-item:hover i {
            color: white;
        }
        
        .dark-mode .dropdown-item:hover i {
            color: white;
        }

        .app-content {
            display: flex;
            margin-top: 70px;
            height: calc(100vh - 70px);
        }

        .sidebar {
            width: 300px;
            background-color: var(--dark-card-bg);
            border-right: 1px solid var(--dark-border);
            height: 100%;
            overflow-y: auto;
            padding: 20px 0;
            transition: all 0.3s;
        }
        
        .dark-mode .sidebar {
            background-color: var(--dark-card-bg);
            border-right-color: var(--dark-border);
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-title {
            padding: 0 20px 10px;
            font-size: 14px;
            color: var(--gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .dark-mode .sidebar-title {
            color: #b9bbbe;
        }

        .sidebar-title i {
            cursor: pointer;
            color: var(--gray);
        }

        .sidebar-title i:hover {
            color: var(--dark-text);
        }

        .sidebar-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--gray);
        }
        
        .dark-mode .sidebar-item {
            color: var(--gray);
        }

        .sidebar-item.active {
            background-color: rgba(79, 84, 92, 0.4);
            border-left: 3px solid var(--primary);
            color: white;
        }
        
        .dark-mode .sidebar-item.active {
            background-color: rgba(79, 84, 92, 0.4);
            border-left-color: var(--accent);
            color: white;
        }

        .sidebar-item:hover:not(.active) {
            background-color: rgba(79, 84, 92, 0.16);
            color: var(--dark-text);
        }
        
        .dark-mode .sidebar-item:hover:not(.active) {
            background-color: rgba(79, 84, 92, 0.16);
            color: var(--dark-text);
        }

        .sidebar-item i {
            margin-right: 10px;
            font-size: 18px;
        }

        .sidebar-item-badge {
            margin-left: auto;
            background-color: var(--danger);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .dark-mode .sidebar-item-badge {
            background-color: var(--danger);
        }

        .friend-request-actions {
            display: flex;
            margin-left: auto;
        }

        .friend-request-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .accept-btn {
            background-color: var(--success);
            color: white;
        }

        .reject-btn {
            background-color: var(--danger);
            color: white;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: var(--dark-bg);
        }

        .chat-header {
            padding: 15px 20px;
            background-color: var(--dark-card-bg);
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
        }
        
        .dark-mode .chat-header {
            background-color: var(--dark-card-bg);
            border-bottom-color: var(--dark-border);
        }

        .chat-user {
            display: flex;
            align-items: center;
        }

        .chat-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }

        .chat-user-name {
            font-weight: 500;
            color: var(--dark-text);
        }
        
        .dark-mode .chat-user-name {
            color: var(--dark-text);
        }

        .chat-user-status {
            font-size: 12px;
            color: var(--gray);
            margin-top: 2px;
        }
        
        .chat-user-status::before {
            content: "•";
            margin-right: 4px;
        }
        
        .chat-user-status.online {
            color: var(--success);
        }
        
        .chat-user-status.offline {
            color: var(--gray);
        }
        
        .chat-user-status.idle {
            color: var(--warning);
        }
        
        .chat-user-status.dnd {
            color: var(--danger);
        }
        
        .dark-mode .chat-user-status {
            color: #b9bbbe;
        }

        .chat-actions {
            margin-left: auto;
            display: flex;
        }

        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: var(--gray);
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark-mode .chat-action-btn {
            background-color: transparent;
            color: var(--gray);
        }

        .chat-action-btn:hover {
            background-color: rgba(79, 84, 92, 0.4);
            color: var(--dark-text);
        }
        
        .dark-mode .chat-action-btn:hover {
            background-color: rgba(79, 84, 92, 0.4);
            color: var(--dark-text);
        }

        .messages-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--dark-bg);
            display: flex;
            flex-direction: column;
            scroll-behavior: smooth;
        }
        
        .dark-mode .messages-container {
            background-color: var(--dark-bg);
        }

        .message {
            display: flex;
            margin-bottom: 15px;
            position: relative;
        }

        .message-incoming {
            justify-content: flex-start;
        }

        .message-outgoing {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
            background-size: cover;
            background-position: center;
        }
        
        .dark-mode .message-avatar {
            background-color: var(--primary);
            color: white;
        }

        .message-outgoing .message-avatar {
            margin-right: 0;
            margin-left: 10px;
            background-color: var(--primary);
            color: white;
        }

        .message-content {
            max-width: 70%;
            min-width: 120px;
        }

        .message-bubble {
            padding: 8px 16px;
            border-radius: 16px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
        }

        .message-incoming .message-bubble {
            background-color: var(--dark-card-bg);
            border-top-left-radius: 0;
            color: var(--dark-text);
        }
        
        .dark-mode .message-incoming .message-bubble {
            background-color: var(--dark-card-bg);
            color: var(--dark-text);
        }

        .message-outgoing .message-bubble {
            background-color: var(--primary);
            color: white;
            border-top-right-radius: 0;
        }

        .message-time {
            font-size: 11px;
            color: var(--gray);
            margin-top: 5px;
            text-align: right;
        }
        
        .dark-mode .message-time {
            color: #b9bbbe;
        }

        .message-incoming .message-time {
            color: var(--gray);
        }
        
        .dark-mode .message-incoming .message-time {
            color: #b9bbbe;
        }

        .message-outgoing .message-time {
            color: rgba(255, 255, 255, 0.7);
        }

        .message-input-container {
            padding: 15px;
            background-color: var(--dark-card-bg);
            border-top: 1px solid var(--dark-border);
            display: flex;
            align-items: center;
        }
        
        .dark-mode .message-input-container {
            background-color: var(--dark-card-bg);
            border-top-color: var(--dark-border);
        }

        .message-input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            background-color: var(--dark-border);
            border-radius: 8px;
            padding: 0 15px;
        }
        
        .dark-mode .message-input-wrapper {
            background-color: var(--dark-border);
        }

        .message-input {
            flex: 1;
            padding: 12px 0;
            border: none;
            font-size: 14px;
            resize: none;
            max-height: 120px;
            outline: none;
            background-color: transparent;
            color: var(--dark-text);
        }
        
        .dark-mode .message-input {
            color: var(--dark-text);
        }

        .message-input:focus {
            box-shadow: none;
        }

        .emoji-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 5px;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.2s;
        }

        .emoji-btn:hover {
            color: var(--primary);
            background-color: rgba(88, 101, 242, 0.1);
        }
        
        .dark-mode .emoji-btn:hover {
            color: var(--accent);
            background-color: rgba(88, 101, 242, 0.2);
        }

        .send-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .send-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }

        .attachment-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 5px;
            cursor: pointer;
            color: var(--gray);
            transition: all 0.2s;
        }
        
        .attachment-btn:hover {
            color: var(--primary);
            background-color: rgba(88, 101, 242, 0.1);
        }
        
        .dark-mode .attachment-btn:hover {
            color: var(--accent);
            background-color: rgba(88, 101, 242, 0.2);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: var(--dark-card-bg);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
            border: 1px solid var(--dark-border);
        }
        
        .dark-mode .modal-content {
            background-color: var(--dark-card-bg);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--dark-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dark-mode .modal-header {
            border-bottom-color: var(--dark-border);
        }

        .modal-title {
            font-weight: 600;
            font-size: 18px;
            color: var(--dark-text);
        }
        
        .dark-mode .modal-title {
            color: var(--dark-text);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .dark-mode .modal-close {
            color: #b9bbbe;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--dark-border);
            display: flex;
            justify-content: flex-end;
        }
        
        .dark-mode .modal-footer {
            border-top-color: var(--dark-border);
        }

        .modal-btn {
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s;
        }

        .modal-btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
        }

        .modal-btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .dark-mode .modal-btn-primary {
            background-color: var(--accent);
        }
        
        .dark-mode .modal-btn-primary:hover {
            background-color: var(--primary);
        }

        .modal-btn-secondary {
            background-color: var(--dark-border);
            color: var(--dark-text);
            border: none;
        }

        .modal-btn-secondary:hover {
            background-color: rgba(79, 84, 92, 0.4);
        }
        
        .dark-mode .modal-btn-secondary {
            background-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        .dark-mode .modal-btn-secondary:hover {
            background-color: rgba(79, 84, 92, 0.4);
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            background-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        .dark-mode .search-input {
            background-color: var(--dark-border);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .user-list {
            list-style: none;
        }

        .user-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--dark-border);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark-mode .user-item {
            border-bottom-color: var(--dark-border);
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }
        
        .dark-mode .user-item:hover {
            background-color: rgba(79, 84, 92, 0.16);
        }

        .user-avatar-small {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
            font-size: 14px;
            background-size: cover;
            background-position: center;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 500;
            color: var(--dark-text);
        }
        
        .dark-mode .user-name {
            color: var(--dark-text);
        }

        .user-email {
            font-size: 12px;
            color: var(--gray);
        }
        
        .dark-mode .user-email {
            color: #b9bbbe;
        }

        .add-friend-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-friend-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Profile Modal */
        .profile-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            background-size: cover;
            background-position: center;
            position: relative;
            cursor: pointer;
        }

        .profile-avatar-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .profile-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
            color: var(--dark-text);
        }

        .profile-email {
            color: var(--gray);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .dark-mode .profile-email {
            color: #b9bbbe;
        }

        .profile-about {
            width: 100%;
            margin-top: 20px;
        }

        .profile-about-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }
        
        .dark-mode .profile-about-title {
            color: var(--accent);
        }

        .profile-about-content {
            background-color: var(--dark-border);
            padding: 15px;
            border-radius: 8px;
            color: var(--dark-text);
        }
        
        .dark-mode .profile-about-content {
            background-color: var(--dark-border);
            color: var(--dark-text);
        }

        /* Settings Page Styles */
        .settings-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--dark-bg);
        }

        .settings-section {
            background-color: var(--dark-card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--dark-border);
        }
        
        .dark-mode .settings-section {
            background-color: var(--dark-card-bg);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .settings-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .dark-mode .settings-title {
            color: var(--accent);
        }

        .settings-title i {
            margin-right: 10px;
        }

        .settings-form {
            margin-top: 15px;
        }

        .form-row {
            display: flex;
            margin-bottom: 15px;
            align-items: center;
        }

        .form-row label {
            width: 150px;
            font-size: 14px;
            color: var(--dark-text);
        }
        
        .dark-mode .form-row label {
            color: var(--dark-text);
        }

        .form-row input, .form-row textarea {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid var(--dark-border);
            border-radius: 5px;
            font-size: 14px;
            background-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        .dark-mode .form-row input,
        .dark-mode .form-row textarea {
            background-color: var(--dark-border);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .form-row textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-row button {
            margin-left: 10px;
            padding: 10px 15px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark-mode .form-row button {
            background-color: var(--accent);
        }

        .form-row button:hover {
            background-color: var(--primary-dark);
        }
        
        .dark-mode .form-row button:hover {
            background-color: var(--primary);
        }

        .verification-code-container {
            display: none;
            margin-top: 10px;
        }
        
        /* Emoji picker */
        .emoji-picker {
            position: absolute;
            bottom: 70px;
            right: 20px;
            width: 300px;
            height: 300px;
            background-color: var(--dark-card-bg);
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 10px;
            display: none;
            z-index: 1000;
            overflow-y: auto;
            border: 1px solid var(--dark-border);
        }
        
        .dark-mode .emoji-picker {
            background-color: var(--dark-card-bg);
        }

        .emoji-category {
            margin-bottom: 10px;
        }

        .emoji-category-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .dark-mode .emoji-category-title {
            color: var(--accent);
        }

        .emoji-list {
            display: flex;
            flex-wrap: wrap;
        }

        .emoji-item {
            font-size: 20px;
            padding: 5px;
            cursor: pointer;
            border-radius: 5px;
        }

        .emoji-item:hover {
            background-color: rgba(79, 84, 92, 0.4);
        }
        
        .dark-mode .emoji-item:hover {
            background-color: rgba(79, 84, 92, 0.4);
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border: none;
        }
        
        .dark-mode .theme-toggle {
            background-color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 250px;
                position: fixed;
                left: -250px;
                top: 70px;
                height: calc(100vh - 70px);
                z-index: 999;
                transition: all 0.3s;
            }
            
            .sidebar.show {
                left: 0;
            }

            .chat-container {
                width: 100%;
            }

            .form-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .form-row label {
                width: 100%;
                margin-bottom: 5px;
            }

            .form-row input, .form-row textarea {
                width: 100%;
            }

            .form-row button {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
            
            .message-content {
                max-width: 80%;
            }
            
            .emoji-picker {
                width: 250px;
                height: 250px;
                right: 10px;
            }
        }
    </style>
</head>
<body class="dark-mode">
    <!-- Auth Container -->
    <div class="auth-container" id="authContainer">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">ND</div>
                <h1>News DC</h1>
                <p>Premium Sohbet Deneyimi</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchTab('login')">Giriş Yap</div>
                <div class="auth-tab" onclick="switchTab('register')">Kayıt Ol</div>
            </div>
            
            <div class="auth-content">
                <!-- Login Form -->
                <div class="auth-form active" id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">E-posta</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="E-postanızı girin">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Şifre</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Şifrenizi girin">
                        <div style="text-align: right; margin-top: 8px;">
                            <a href="#" style="color: var(--primary); font-size: 13px;" onclick="showForgotPassword()">Şifremi unuttum?</a>
                        </div>
                    </div>
                    <button class="btn" onclick="login()">Giriş Yap</button>
                    
                    <div class="divider">veya</div>
                    
                    <button class="btn btn-google" onclick="loginWithGoogle()">
                        <i class="fab fa-google"></i>
                        <span>Google ile Giriş Yap</span>
                    </button>
                </div>
                
                <!-- Register Form -->
                <div class="auth-form" id="registerForm">
                    <div class="form-group">
                        <label for="registerName">İsim</label>
                        <input type="text" id="registerName" class="form-control" placeholder="Adınız ve soyadınız">
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">E-posta</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="E-postanızı girin">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Şifre</label>
                        <input type="password" id="registerPassword" class="form-control" placeholder="Şifrenizi oluşturun (en az 6 karakter)">
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword">Şifre Tekrar</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Şifrenizi tekrar girin">
                    </div>
                    <button class="btn" onclick="register()">Kayıt Ol</button>
                    
                    <div class="divider">veya</div>
                    
                    <button class="btn btn-google" onclick="registerWithGoogle()">
                        <i class="fab fa-google"></i>
                        <span>Google ile Kayıt Ol</span>
                    </button>
                </div>
                
                <!-- Forgot Password Form -->
                <div class="auth-form" id="forgotPasswordForm">
                    <div class="form-group">
                        <label for="forgotEmail">E-posta</label>
                        <input type="email" id="forgotEmail" class="form-control" placeholder="Kayıtlı e-postanızı girin">
                    </div>
                    <button class="btn" onclick="sendPasswordReset()">Şifre Sıfırlama Bağlantısı Gönder</button>
                    <button class="btn" style="background-color: var(--dark-border); color: var(--dark-text); margin-top: 10px;" onclick="switchTab('login')">
                        Giriş Sayfasına Dön
                    </button>
                </div>
                
                <!-- Email Verification Form -->
                <div class="auth-form" id="verifyEmailForm">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-envelope" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                        <h3>E-posta Doğrulama Gerekli</h3>
                        <p style="color: var(--gray);">E-postanıza bir doğrulama bağlantısı gönderildi. Lütfen e-postanızı kontrol edin ve bağlantıya tıklayın.</p>
                    </div>
                    <button class="btn" onclick="checkEmailVerification()">
                        <i class="fas fa-check"></i> Doğrulandı, Devam Et
                    </button>
                    <button class="btn" style="background-color: var(--dark-border); color: var(--dark-text); margin-top: 10px;" onclick="resendVerificationEmail()">
                        <i class="fas fa-redo"></i> Bağlantıyı Tekrar Gönder
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- App Container -->
    <div id="appContainer">
        <header class="app-header">
            <div class="app-logo">
                <i class="fas fa-comment-dots"></i>
                <span>News DC</span>
            </div>
            <div class="user-menu">
                <div class="user-avatar" id="userAvatar" onclick="toggleDropdown()">U</div>
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="dropdown-item" onclick="showProfile()">
                        <i class="fas fa-user"></i>
                        <span>Profil</span>
                    </div>
                    <div class="dropdown-item" onclick="showSettings()">
                        <i class="fas fa-cog"></i>
                        <span>Ayarlar</span>
                    </div>
                    <div class="dropdown-item" onclick="toggleDarkMode()">
                        <i class="fas fa-moon"></i>
                        <span id="darkModeText">Açık Mod</span>
                    </div>
                    <div class="dropdown-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Çıkış Yap</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="app-content">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <span>Arkadaşlar</span>
                        <i class="fas fa-plus" onclick="showAddFriendModal()"></i>
                    </div>
                    <div id="friendsList">
                        <!-- Arkadaşlar buraya dinamik olarak eklenecek -->
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <span>Arkadaş İstekleri</span>
                        <span class="sidebar-item-badge" id="friendRequestsBadge">0</span>
                    </div>
                    <div id="friendRequestsList">
                        <!-- Arkadaş istekleri buraya dinamik olarak eklenecek -->
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div id="mainContent">
                <!-- Chat Container (Default) -->
                <div class="chat-container" id="chatContainer">
                    <div class="chat-header">
                        <div class="chat-user">
                            <div class="chat-user-avatar" id="currentChatAvatar">?</div>
                            <div>
                                <div class="chat-user-name" id="currentChatName">Sohbet Seçin</div>
                                <div class="chat-user-status online" id="currentChatStatus">çevrimiçi</div>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <div class="chat-action-btn">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="chat-action-btn">
                                <i class="fas fa-ellipsis-v"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="messages-container" id="messagesContainer">
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-comments" style="font-size: 48px; margin-bottom: 15px;"></i>
                            <h3>Bir sohbet seçin</h3>
                            <p>Arkadaşlarınızla gerçek zamanlı olarak mesajlaşmaya başlayın</p>
                        </div>
                    </div>
                    
                    <div class="message-input-container" id="messageInputContainer" style="display: none;">
                        <button class="attachment-btn" onclick="showFilePicker()">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <div class="message-input-wrapper">
                            <button class="emoji-btn" onclick="toggleEmojiPicker()">
                                <i class="far fa-smile"></i>
                            </button>
                            <textarea class="message-input" id="messageInput" placeholder="Bir mesaj yazın..." rows="1"></textarea>
                        </div>
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                        
                        <!-- Emoji Picker -->
                        <div class="emoji-picker" id="emojiPicker">
                            <div class="emoji-category">
                                <div class="emoji-category-title">Sık Kullanılanlar</div>
                                <div class="emoji-list" id="frequentEmojis">
                                    <!-- Sık kullanılan emojiler buraya eklenecek -->
                                </div>
                            </div>
                            <div class="emoji-category">
                                <div class="emoji-category-title">Yüz İfadeleri</div>
                                <div class="emoji-list" id="smileyEmojis">
                                    <!-- Yüz ifadesi emojileri buraya eklenecek -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Container (Hidden by default) -->
                <div class="settings-container" id="settingsContainer" style="display: none;">
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-user-edit"></i>
                            <span>Profil Bilgileri</span>
                        </div>
                        <div class="settings-form">
                            <div class="form-row">
                                <label for="settingsName">İsim:</label>
                                <input type="text" id="settingsName" placeholder="Adınız ve soyadınız">
                                <button onclick="updateProfileName()">Güncelle</button>
                            </div>
                            <div class="form-row">
                                <label for="settingsAbout">Hakkında:</label>
                                <textarea id="settingsAbout" placeholder="Kendiniz hakkında bir şeyler yazın"></textarea>
                                <button onclick="updateProfileAbout()">Güncelle</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-envelope"></i>
                            <span>E-posta Adresi</span>
                        </div>
                        <div class="settings-form">
                            <div class="form-row">
                                <label for="settingsEmail">Mevcut E-posta:</label>
                                <input type="email" id="settingsEmail" disabled>
                            </div>
                            <div class="form-row">
                                <label for="newEmail">Yeni E-posta:</label>
                                <input type="email" id="newEmail" placeholder="Yeni e-posta adresiniz">
                                <button onclick="sendEmailVerificationCode()">Doğrulama Kodu Gönder</button>
                            </div>
                            <div class="verification-code-container" id="emailVerificationContainer">
                                <div class="form-row">
                                    <label for="verificationCode">Doğrulama Kodu:</label>
                                    <input type="text" id="verificationCode" placeholder="E-postanıza gelen kodu girin">
                                    <button onclick="verifyEmailAndUpdate()">Doğrula ve Güncelle</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <div class="settings-title">
                            <i class="fas fa-lock"></i>
                            <span>Şifre Değiştir</span>
                        </div>
                        <div class="settings-form">
                            <div class="form-row">
                                <label for="currentPassword">Mevcut Şifre:</label>
                                <input type="password" id="currentPassword" placeholder="Mevcut şifreniz">
                            </div>
                            <div class="form-row">
                                <label for="newPassword">Yeni Şifre:</label>
                                <input type="password" id="newPassword" placeholder="Yeni şifreniz (en az 6 karakter)">
                            </div>
                            <div class="form-row">
                                <label for="confirmNewPassword">Yeni Şifre Tekrar:</label>
                                <input type="password" id="confirmNewPassword" placeholder="Yeni şifrenizi tekrar girin">
                                <button onclick="updatePassword()">Şifreyi Güncelle</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Theme Toggle Button -->
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-sun"></i>
        </button>
    </div>
    
    <!-- Add Friend Modal -->
    <div class="modal" id="addFriendModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Arkadaş Ekle</div>
                <button class="modal-close" onclick="closeAddFriendModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="text" class="search-input" id="friendSearchInput" placeholder="Kullanıcı adı veya e-posta ara...">
                <ul class="user-list" id="userSearchResults">
                    <!-- Arama sonuçları buraya eklenecek -->
                </ul>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Profil</div>
                <button class="modal-close" onclick="closeProfileModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="profile-container">
                    <div class="profile-avatar" id="profileAvatar" onclick="changeProfilePicture()">
                        <div class="profile-avatar-edit">
                            <i class="fas fa-camera"></i>
                        </div>
                    </div>
                    <div class="profile-name" id="profileName"></div>
                    <div class="profile-email" id="profileEmail"></div>
                    
                    <div class="profile-about">
                        <div class="profile-about-title">Hakkında</div>
                        <div class="profile-about-content" id="profileAbout">
                            Henüz bir bilgi eklenmemiş.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase and other scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    
    <script>
        // Firebase configuration - BU KISMI KENDİ BİLGİLERİNİZLE DEĞİŞTİRİN
        const firebaseConfig = {
            apiKey: "AIzaSyDH5GBWQNoZv7LZZ2MbFjh-twI1jZuYqK0",
            authDomain: "newdc-d6404.firebaseapp.com",
            projectId: "newdc-d6404",
            storageBucket: "newdc-d6404.appspot.com",
            messagingSenderId: "101292652984",
            appId: "1:101292652984:web:59d6b49b400572bec1774d",
            measurementId: "G-NV86JDVJ27"
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // Google provider for authentication
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // Global variables
        let currentUser = null;
        let currentChat = null;
        let currentChatUser = null;
        let unsubscribeMessages = null;
        let emailVerificationCode = null;
        let profilePictureFile = null;
        
        // Emoji list
        const emojis = {
            smileys: ["😀", "😃", "😄", "😁", "😆", "😅", "😂", "🤣", "😊", "😇", "🙂", "🙃", "😉", "😌", "😍", "🥰", "😘", "😗", "😙", "😚", "😋", "😛", "😝", "😜", "🤪", "🤨", "🧐", "🤓", "😎", "🤩", "🥳", "😏", "😒", "😞", "😔", "😟", "😕", "🙁", "☹️", "😣", "😖", "😫", "😩", "🥺", "😢", "😭", "😤", "😠", "😡", "🤬", "🤯", "😳", "🥵", "🥶", "😱", "😨", "😰", "😥", "😓", "🤗", "🤔", "🤭", "🤫", "🤥", "😶", "😐", "😑", "😬", "🙄", "😯", "😦", "😧", "😮", "😲", "🥱", "😴", "🤤", "😪", "😵", "🤐", "🥴", "🤢", "🤮", "🤧", "😷", "🤒", "🤕", "🤑", "🤠", "😈", "👿", "👹", "👺", "🤡", "💩", "👻", "💀", "☠️", "👽", "👾", "🤖", "🎃", "😺", "😸", "😹", "😻", "😼", "😽", "🙀", "😿", "😾"]
        };
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();
            setupEventListeners();
            checkDarkModePreference();
            initEmojiPicker();
            
            // Mesaj giriş alanını otomatik büyütme
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });
        
        function initAuth() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    updateUserAvatar();
                    if (user.emailVerified) {
                        showApp();
                        loadUserData(user);
                        // Update email field in settings
                        document.getElementById('settingsEmail').value = user.email;
                        document.getElementById('settingsName').value = user.displayName || '';
                        
                        // Save user to Firestore if not exists
                        db.collection('users').doc(user.uid).set({
                            name: user.displayName || 'Kullanıcı',
                            email: user.email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'online',
                            about: ''
                        }, { merge: true }).then(() => {
                            // Load profile picture if exists
                            loadProfilePicture();
                        });
                    } else {
                        showVerifyEmailForm();
                    }
                } else {
                    currentUser = null;
                    showAuth();
                }
            }, error => {
                showError(error, "Auth State Listener");
            });
        }
        
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.textContent.includes('Giriş') ? 'login' : 'register';
                    switchTab(tabName);
                });
            });
            
            // Form submissions
            document.getElementById('loginForm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('registerForm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') register();
            });
            
            // Message input
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // Friend search input
            document.getElementById('friendSearchInput').addEventListener('input', function() {
                searchUsers(this.value.trim());
            });
            
            // Theme toggle button
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
            
            // Click outside emoji picker to close it
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.emoji-btn') && !e.target.closest('.emoji-picker')) {
                    document.getElementById('emojiPicker').style.display = 'none';
                }
            });
        }
        
        function initEmojiPicker() {
            const smileyEmojisContainer = document.getElementById('smileyEmojis');
            
            emojis.smileys.forEach(emoji => {
                const emojiElement = document.createElement('span');
                emojiElement.className = 'emoji-item';
                emojiElement.textContent = emoji;
                emojiElement.addEventListener('click', () => {
                    addEmojiToMessage(emoji);
                });
                smileyEmojisContainer.appendChild(emojiElement);
            });
        }
        
        function toggleEmojiPicker() {
            const picker = document.getElementById('emojiPicker');
            picker.style.display = picker.style.display === 'block' ? 'none' : 'block';
        }
        
        function addEmojiToMessage(emoji) {
            const input = document.getElementById('messageInput');
            input.value += emoji;
            input.focus();
        }
        
        function loadUserData(user) {
            console.log("User data loaded:", user);
            
            // Load friends
            loadFriends();
            
            // Load friend requests
            loadFriendRequests();
            
            // Load profile about
            db.collection('users').doc(user.uid).get().then(doc => {
                if (doc.exists && doc.data().about) {
                    document.getElementById('settingsAbout').value = doc.data().about;
                }
            });
        }
        
        function loadFriends() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).collection('friends')
                .where('status', '==', 'accepted')
                .onSnapshot(snapshot => {
                    const friendsList = document.getElementById('friendsList');
                    friendsList.innerHTML = '';
                    
                    snapshot.forEach(doc => {
                        const friendData = doc.data();
                        addFriendToSidebar(friendData, doc.id);
                    });
                });
        }
        
        function loadFriendRequests() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).collection('friendRequests')
                .where('status', '==', 'pending')
                .onSnapshot(snapshot => {
                    const friendRequestsList = document.getElementById('friendRequestsList');
                    friendRequestsList.innerHTML = '';
                    
                    // Update badge count
                    document.getElementById('friendRequestsBadge').textContent = snapshot.size;
                    
                    snapshot.forEach(doc => {
                        const requestData = doc.data();
                        addFriendRequestToSidebar(requestData, doc.id);
                    });
                });
        }
        
        function addFriendToSidebar(friendData, friendId) {
            const friendsList = document.getElementById('friendsList');
            
            const friendItem = document.createElement('div');
            friendItem.className = 'sidebar-item';
            friendItem.innerHTML = `
                <div class="user-avatar-small" style="background-color: ${getRandomColor()}">
                    ${friendData.name.charAt(0).toUpperCase()}
                </div>
                <span>${friendData.name}</span>
            `;
            
            friendItem.addEventListener('click', () => {
                openChat(friendId, friendData);
            });
            
            friendsList.appendChild(friendItem);
        }
        
        function addFriendRequestToSidebar(requestData, requestId) {
            const friendRequestsList = document.getElementById('friendRequestsList');
            
            const requestItem = document.createElement('div');
            requestItem.className = 'sidebar-item';
            requestItem.innerHTML = `
                <div class="user-avatar-small" style="background-color: ${getRandomColor()}">
                    ${requestData.senderName.charAt(0).toUpperCase()}
                </div>
                <span>${requestData.senderName}</span>
                <div class="friend-request-actions">
                    <div class="friend-request-btn accept-btn" onclick="event.stopPropagation(); acceptFriendRequest('${requestId}', '${requestData.senderId}', '${requestData.senderName}')">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="friend-request-btn reject-btn" onclick="event.stopPropagation(); rejectFriendRequest('${requestId}')">
                        <i class="fas fa-times"></i>
                    </div>
                </div>
            `;
            
            friendRequestsList.appendChild(requestItem);
        }
        
        function openChat(friendId, friendData) {
            // Close previous chat listener
            if (unsubscribeMessages) unsubscribeMessages();
            
            // Update current chat info
            currentChat = `private_${[currentUser.uid, friendId].sort().join('_')}`;
            currentChatUser = friendData;
            
            // Update UI
            document.getElementById('currentChatName').textContent = friendData.name;
            document.getElementById('currentChatAvatar').textContent = friendData.name.charAt(0).toUpperCase();
            document.getElementById('currentChatAvatar').style.backgroundColor = getRandomColor();
            document.getElementById('currentChatStatus').textContent = 'çevrimiçi';
            document.getElementById('currentChatStatus').className = 'chat-user-status online';
            document.getElementById('messageInputContainer').style.display = 'flex';
            
            // Clear messages container
            const messagesContainer = document.getElementById('messagesContainer');
            messagesContainer.innerHTML = '';
            
            // Load messages
            unsubscribeMessages = db.collection('chats').doc(currentChat).collection('messages')
                .orderBy('timestamp', 'asc')
                .onSnapshot(snapshot => {
                    snapshot.docChanges().forEach(change => {
                        if (change.type === 'added') {
                            addMessageToUI(change.doc.data());
                        }
                    });
                    
                    // Scroll to bottom
                    scrollToBottom();
                }, error => {
                    console.error("Error loading messages:", error);
                });
        }
        
        function addMessageToUI(message) {
            const messagesContainer = document.getElementById('messagesContainer');
            const isOutgoing = message.senderId === currentUser.uid;
            
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isOutgoing ? 'message-outgoing' : 'message-incoming'}`;
            
            const time = new Date(message.timestamp?.toDate()).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            messageElement.innerHTML = `
                ${!isOutgoing ? `<div class="message-avatar" style="background-color: ${getRandomColor()}">${currentChatUser.name.charAt(0).toUpperCase()}</div>` : ''}
                <div class="message-content">
                    <div class="message-bubble">${message.text}</div>
                    <div class="message-time">${time}</div>
                </div>
                ${isOutgoing ? `<div class="message-avatar" style="background-color: ${getRandomColor()}">${currentUser.displayName.charAt(0).toUpperCase()}</div>` : ''}
            `;
            
            messagesContainer.appendChild(messageElement);
            
            // Scroll to bottom if user is near bottom
            scrollToBottom();
        }
        
        function scrollToBottom() {
            const messagesContainer = document.getElementById('messagesContainer');
            const isNearBottom = messagesContainer.scrollHeight - messagesContainer.clientHeight <= messagesContainer.scrollTop + 100;
            
            if (isNearBottom) {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
        }
        
        function sendMessage() {
            if (!currentChat || !currentUser) return;
            
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();
            
            if (!messageText) return;
            
            // Add message to Firestore
            db.collection('chats').doc(currentChat).collection('messages').add({
                text: messageText,
                senderId: currentUser.uid,
                senderName: currentUser.displayName || 'Anonim',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).catch(error => {
                console.error("Error sending message: ", error);
                showError(error, "Send Message");
            });
            
            // Clear input
            input.value = '';
            input.style.height = 'auto';
        }
        
        function searchUsers(query) {
            if (!query || query.length < 2) {
                document.getElementById('userSearchResults').innerHTML = '';
                return;
            }
            
            // Search by name or email
            db.collection('users')
                .where('name', '>=', query)
                .where('name', '<=', query + '\uf8ff')
                .get()
                .then(snapshot => {
                    const resultsContainer = document.getElementById('userSearchResults');
                    resultsContainer.innerHTML = '';
                    
                    if (snapshot.empty) {
                        resultsContainer.innerHTML = '<li style="padding: 15px; text-align: center; color: var(--gray);">Kullanıcı bulunamadı</li>';
                        return;
                    }
                    
                    snapshot.forEach(doc => {
                        // Don't show current user in results
                        if (doc.id === currentUser.uid) return;
                        
                        const userData = doc.data();
                        const userItem = document.createElement('li');
                        userItem.className = 'user-item';
                        userItem.innerHTML = `
                            <div class="user-avatar-small" style="background-color: ${getRandomColor()}">
                                ${userData.name.charAt(0).toUpperCase()}
                            </div>
                            <div class="user-info">
                                <div class="user-name">${userData.name}</div>
                                <div class="user-email">${userData.email}</div>
                            </div>
                            <button class="add-friend-btn" onclick="event.stopPropagation(); sendFriendRequest('${doc.id}', '${userData.name}')">
                                Ekle
                            </button>
                        `;
                        
                        userItem.addEventListener('click', () => {
                            showUserProfile(doc.id, userData);
                        });
                        
                        resultsContainer.appendChild(userItem);
                    });
                })
                .catch(error => {
                    console.error("Error searching users:", error);
                    showError(error, "User Search");
                });
        }
        
        function sendFriendRequest(receiverId, receiverName) {
            if (!currentUser) return;
            
            // Check if request already exists
            db.collection('users').doc(receiverId).collection('friendRequests')
                .where('senderId', '==', currentUser.uid)
                .where('status', '==', 'pending')
                .get()
                .then(snapshot => {
                    if (!snapshot.empty) {
                        showError({ message: "Bu kullanıcıya zaten bir arkadaş isteği gönderdiniz" });
                        return;
                    }
                    
                    // Check if already friends
                    db.collection('users').doc(currentUser.uid).collection('friends')
                        .doc(receiverId).get()
                        .then(doc => {
                            if (doc.exists && doc.data().status === 'accepted') {
                                showError({ message: "Bu kullanıcı zaten arkadaşınız" });
                                return;
                            }
                            
                            // Create friend request
                            const requestData = {
                                senderId: currentUser.uid,
                                senderName: currentUser.displayName || 'Anonim',
                                receiverId: receiverId,
                                receiverName: receiverName,
                                status: 'pending',
                                timestamp: firebase.firestore.FieldValue.serverTimestamp()
                            };
                            
                            // Add to receiver's requests
                            db.collection('users').doc(receiverId).collection('friendRequests').add(requestData)
                                .then(() => {
                                    showSuccess("Arkadaş isteği gönderildi!");
                                    closeAddFriendModal();
                                })
                                .catch(error => {
                                    console.error("Error sending friend request:", error);
                                    showError(error, "Send Friend Request");
                                });
                        });
                });
        }
        
        function acceptFriendRequest(requestId, senderId, senderName) {
            if (!currentUser) return;
            
            // Update request status
            db.collection('users').doc(currentUser.uid).collection('friendRequests').doc(requestId).update({
                status: 'accepted',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                // Add to friends list for both users
                const currentUserData = {
                    userId: currentUser.uid,
                    name: currentUser.displayName || 'Anonim',
                    status: 'accepted',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const senderUserData = {
                    userId: senderId,
                    name: senderName,
                    status: 'accepted',
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Add to current user's friends
                db.collection('users').doc(currentUser.uid).collection('friends').doc(senderId).set(senderUserData);
                
                // Add to sender's friends
                db.collection('users').doc(senderId).collection('friends').doc(currentUser.uid).set(currentUserData);
                
                showSuccess(`${senderName} arkadaş olarak eklendi!`);
            })
            .catch(error => {
                console.error("Error accepting friend request:", error);
                showError(error, "Accept Friend Request");
            });
        }
        
        function rejectFriendRequest(requestId) {
            if (!currentUser) return;
            
            // Delete the request
            db.collection('users').doc(currentUser.uid).collection('friendRequests').doc(requestId).delete()
                .then(() => {
                    showSuccess("Arkadaş isteği reddedildi");
                })
                .catch(error => {
                    console.error("Error rejecting friend request:", error);
                    showError(error, "Reject Friend Request");
                });
        }
        
        function showAddFriendModal() {
            document.getElementById('addFriendModal').classList.add('show');
            document.getElementById('friendSearchInput').focus();
        }
        
        function closeAddFriendModal() {
            document.getElementById('addFriendModal').classList.remove('show');
            document.getElementById('friendSearchInput').value = '';
            document.getElementById('userSearchResults').innerHTML = '';
        }
        
        function showProfile() {
            // Hide chat container and show settings
            document.getElementById('chatContainer').style.display = 'none';
            document.getElementById('settingsContainer').style.display = 'block';
            toggleDropdown();
        }
        
        function showSettings() {
            // Hide chat container and show settings
            document.getElementById('chatContainer').style.display = 'none';
            document.getElementById('settingsContainer').style.display = 'block';
            toggleDropdown();
        }
        
        function showUserProfile(userId, userData) {
            const profileModal = document.getElementById('profileModal');
            const profileAvatar = document.getElementById('profileAvatar');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const profileAbout = document.getElementById('profileAbout');
            
            // Set profile data
            profileName.textContent = userData.name;
            profileEmail.textContent = userData.email;
            
            // Load profile picture if exists
            storage.ref(`profile_pictures/${userId}`).getDownloadURL()
                .then(url => {
                    profileAvatar.style.backgroundImage = `url(${url})`;
                    profileAvatar.textContent = '';
                })
                .catch(() => {
                    profileAvatar.style.backgroundImage = '';
                    profileAvatar.textContent = userData.name.charAt(0).toUpperCase();
                    profileAvatar.style.backgroundColor = getRandomColor();
                });
            
            // Load about text
            db.collection('users').doc(userId).get().then(doc => {
                if (doc.exists && doc.data().about) {
                    profileAbout.textContent = doc.data().about;
                } else {
                    profileAbout.textContent = "Henüz bir bilgi eklenmemiş.";
                }
            });
            
            // Show modal
            profileModal.classList.add('show');
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('show');
        }
        
        function updateProfileName() {
            const newName = document.getElementById('settingsName').value.trim();
            
            if (!newName) {
                showError({ message: "Lütfen bir isim girin" });
                return;
            }
            
            currentUser.updateProfile({
                displayName: newName
            }).then(() => {
                // Update in Firestore
                db.collection('users').doc(currentUser.uid).update({
                    name: newName
                }).then(() => {
                    showSuccess("İsim başarıyla güncellendi!");
                    updateUserAvatar();
                }).catch(error => {
                    console.error("Error updating name in Firestore:", error);
                    showError(error, "Update Name");
                });
            }).catch(error => {
                console.error("Error updating profile:", error);
                showError(error, "Update Profile");
            });
        }
        
        function updateProfileAbout() {
            const aboutText = document.getElementById('settingsAbout').value.trim();
            
            db.collection('users').doc(currentUser.uid).update({
                about: aboutText
            }).then(() => {
                showSuccess("Hakkında bilgisi güncellendi!");
            }).catch(error => {
                console.error("Error updating about:", error);
                showError(error, "Update About");
            });
        }
        
        function changeProfilePicture() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            
            input.onchange = e => {
                profilePictureFile = e.target.files[0];
                if (profilePictureFile) {
                    uploadProfilePicture();
                }
            };
            
            input.click();
        }
        
        function uploadProfilePicture() {
            if (!profilePictureFile) return;
            
            const uploadTask = storage.ref(`profile_pictures/${currentUser.uid}`).put(profilePictureFile);
            
            uploadTask.on('state_changed', 
                (snapshot) => {
                    // Progress monitoring can be added here
                }, 
                (error) => {
                    console.error("Error uploading profile picture:", error);
                    showError(error, "Upload Profile Picture");
                }, 
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then(downloadURL => {
                        // Update avatar in UI
                        const avatar = document.getElementById('userAvatar');
                        avatar.style.backgroundImage = `url(${downloadURL})`;
                        avatar.textContent = '';
                        
                        // Update in Firestore
                        db.collection('users').doc(currentUser.uid).update({
                            profilePicture: downloadURL
                        }).then(() => {
                            showSuccess("Profil fotoğrafı başarıyla güncellendi!");
                        });
                    });
                }
            );
        }
        
        function loadProfilePicture() {
            storage.ref(`profile_pictures/${currentUser.uid}`).getDownloadURL()
                .then(url => {
                    const avatar = document.getElementById('userAvatar');
                    avatar.style.backgroundImage = `url(${url})`;
                    avatar.textContent = '';
                })
                .catch(() => {
                    // No profile picture exists
                });
        }
        
        function sendEmailVerificationCode() {
            const newEmail = document.getElementById('newEmail').value.trim();
            
            if (!newEmail) {
                showError({ message: "Lütfen yeni e-posta adresinizi girin" });
                return;
            }
            
            // Generate a random 6-digit code
            emailVerificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            // In a real app, you would send this code to the user's email
            // For demo purposes, we'll just show it in an alert
            alert(`Demo amaçlı - Doğrulama kodunuz: ${emailVerificationCode}\nGerçek uygulamada bu kod e-postanıza gönderilecektir.`);
            
            // Show verification code input
            document.getElementById('emailVerificationContainer').style.display = 'block';
        }
        
        function verifyEmailAndUpdate() {
            const newEmail = document.getElementById('newEmail').value.trim();
            const code = document.getElementById('verificationCode').value.trim();
            
            if (!newEmail || !code) {
                showError({ message: "Lütfen yeni e-posta ve doğrulama kodunu girin" });
                return;
            }
            
            if (code !== emailVerificationCode) {
                showError({ message: "Doğrulama kodu hatalı!" });
                return;
            }
            
            currentUser.updateEmail(newEmail).then(() => {
                // Update in Firestore
                db.collection('users').doc(currentUser.uid).update({
                    email: newEmail
                }).then(() => {
                    showSuccess("E-posta adresi başarıyla güncellendi!");
                    document.getElementById('settingsEmail').value = newEmail;
                    document.getElementById('newEmail').value = '';
                    document.getElementById('verificationCode').value = '';
                    document.getElementById('emailVerificationContainer').style.display = 'none';
                    
                    // Send verification email
                    currentUser.sendEmailVerification().then(() => {
                        showSuccess("Doğrulama e-postası gönderildi. Lütfen e-postanızı kontrol edin.");
                    }).catch(error => {
                        console.error("Error sending verification email:", error);
                    });
                }).catch(error => {
                    console.error("Error updating email in Firestore:", error);
                    showError(error, "Update Email");
                });
            }).catch(error => {
                console.error("Error updating email:", error);
                showError(error, "Update Email");
            });
        }
        
        function updatePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;
            
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showError({ message: "Lütfen tüm alanları doldurun" });
                return;
            }
            
            if (newPassword.length < 6) {
                showError({ message: "Şifre en az 6 karakter olmalıdır" });
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showError({ message: "Yeni şifreler eşleşmiyor!" });
                return;
            }
            
            // Reauthenticate user
            const credential = firebase.auth.EmailAuthProvider.credential(
                currentUser.email,
                currentPassword
            );
            
            currentUser.reauthenticateWithCredential(credential).then(() => {
                // Update password
                currentUser.updatePassword(newPassword).then(() => {
                    showSuccess("Şifre başarıyla güncellendi!");
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmNewPassword').value = '';
                }).catch(error => {
                    console.error("Error updating password:", error);
                    showError(error, "Update Password");
                });
            }).catch(error => {
                console.error("Error reauthenticating:", error);
                showError({ message: "Mevcut şifre hatalı!" });
            });
        }
        
        function showFilePicker() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            
            input.onchange = e => {
                const files = e.target.files;
                if (files.length > 0) {
                    // Handle file uploads
                    showError({ message: "Dosya yükleme özelliği şu anda kullanılamıyor" });
                }
            };
            
            input.click();
        }
        
        function checkDarkModePreference() {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeText').textContent = 'Açık Mod';
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.getElementById('darkModeText').textContent = 'Koyu Mod';
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        
        function toggleDarkMode() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            
            const isDarkMode = body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                document.getElementById('darkModeText').textContent = 'Açık Mod';
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.getElementById('darkModeText').textContent = 'Koyu Mod';
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            }
            
            toggleDropdown();
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            if (tabName === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else if (tabName === 'register') {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }
        
        function showForgotPassword() {
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById('forgotPasswordForm').classList.add('active');
        }
        
        function showVerifyEmailForm() {
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById('verifyEmailForm').classList.add('active');
        }
        
        function showAuth() {
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
        }
        
        function showApp() {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
        }
        
        function toggleDropdown() {
            document.getElementById('dropdownMenu').classList.toggle('show');
        }
        
        function updateUserAvatar() {
            if (currentUser) {
                const avatar = document.getElementById('userAvatar');
                const displayName = currentUser.displayName || 'Kullanıcı';
                avatar.textContent = displayName.charAt(0).toUpperCase();
                avatar.style.backgroundColor = getRandomColor();
            }
        }
        
        function getRandomColor() {
            const colors = ['#5865f2', '#3f37c9', '#4895ef', '#4cc9f0', '#560bad', '#b5179e'];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function showError(error, context = "") {
            console.error(context, error);
            
            let errorMessage = "Bir hata oluştu";
            if (error.code) {
                switch(error.code) {
                    case "auth/invalid-email":
                        errorMessage = "Geçersiz e-posta adresi";
                        break;
                    case "auth/user-disabled":
                        errorMessage = "Bu kullanıcı devre dışı bırakılmış";
                        break;
                    case "auth/user-not-found":
                        errorMessage = "Kullanıcı bulunamadı";
                        break;
                    case "auth/wrong-password":
                        errorMessage = "Hatalı şifre";
                        break;
                    case "auth/email-already-in-use":
                        errorMessage = "Bu e-posta zaten kullanımda";
                        break;
                    case "auth/operation-not-allowed":
                        errorMessage = "Bu işlem şu anda izin verilmiyor";
                        break;
                    case "auth/weak-password":
                        errorMessage = "Şifre en az 6 karakter olmalı";
                        break;
                    case "auth/too-many-requests":
                        errorMessage = "Çok fazla deneme yaptınız, lütfen daha sonra tekrar deneyin";
                        break;
                    case "auth/requires-recent-login":
                        errorMessage = "Bu işlem için son zamanlarda tekrar giriş yapmanız gerekiyor";
                        break;
                }
            } else if (error.message) {
                errorMessage = error.message;
            }
            
            // Show error message
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message';
            errorElement.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                <span>${errorMessage}</span>
            `;
            
            // Find the active form and prepend the error message
            const activeForm = document.querySelector('.auth-form.active');
            if (activeForm) {
                // Remove any existing error messages
                const existingError = activeForm.querySelector('.error-message');
                if (existingError) existingError.remove();
                
                activeForm.prepend(errorElement);
                
                // Remove error after 5 seconds
                setTimeout(() => {
                    errorElement.remove();
                }, 5000);
            } else {
                alert(errorMessage);
            }
        }
        
        function showSuccess(message) {
            // Show success message
            const successElement = document.createElement('div');
            successElement.className = 'success-message';
            successElement.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
            
            // Find the active form and prepend the success message
            const activeForm = document.querySelector('.auth-form.active');
            if (activeForm) {
                // Remove any existing messages
                const existingMsg = activeForm.querySelector('.success-message');
                if (existingMsg) existingMsg.remove();
                
                activeForm.prepend(successElement);
                
                // Remove message after 5 seconds
                setTimeout(() => {
                    successElement.remove();
                }, 5000);
            } else {
                alert(message);
            }
        }
        
        // Login with email/password
        function login() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError({ message: "Lütfen e-posta ve şifrenizi girin" });
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    if (!userCredential.user.emailVerified) {
                        auth.signOut();
                        showVerifyEmailForm();
                        showError({ message: "Lütfen e-postanızı doğrulayın. Doğrulama bağlantısı e-postanıza gönderildi." });
                    } else {
                        showSuccess("Giriş başarılı!");
                    }
                })
                .catch((error) => {
                    showError(error, "Login");
                });
        }
        
        // Register with email/password
        function register() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (!name || !email || !password || !confirmPassword) {
                showError({ message: "Lütfen tüm alanları doldurun" });
                return;
            }
            
            if (password.length < 6) {
                showError({ message: "Şifre en az 6 karakter olmalıdır" });
                return;
            }
            
            if (password !== confirmPassword) {
                showError({ message: "Şifreler eşleşmiyor!" });
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Update user profile with display name
                    return userCredential.user.updateProfile({
                        displayName: name
                    }).then(() => {
                        // Save additional user data to Firestore
                        return db.collection('users').doc(userCredential.user.uid).set({
                            name: name,
                            email: email,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            status: 'online',
                            about: ''
                        }, { merge: true });
                    }).then(() => {
                        // Send email verification
                        return userCredential.user.sendEmailVerification({
                            url: window.location.href,
                            handleCodeInApp: true
                        });
                    });
                })
                .then(() => {
                    showVerifyEmailForm();
                    showSuccess("Kayıt başarılı! Lütfen e-postanızı doğrulayın.");
                })
                .catch((error) => {
                    showError(error, "Register");
                });
        }
        
        // Login with Google
        function loginWithGoogle() {
            auth.signInWithPopup(googleProvider)
                .then((result) => {
                    // Check if user exists in Firestore
                    return db.collection('users').doc(result.user.uid).get()
                        .then(doc => {
                            if (!doc.exists) {
                                // Save user data if new user
                                return db.collection('users').doc(result.user.uid).set({
                                    name: result.user.displayName,
                                    email: result.user.email,
                                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                                    status: 'online',
                                    about: ''
                                }, { merge: true });
                            }
                        }).then(() => {
                            showSuccess("Google ile giriş başarılı!");
                        });
                })
                .catch((error) => {
                    showError(error, "Google Login");
                });
        }
        
        // Register with Google
        function registerWithGoogle() {
            loginWithGoogle(); // Same as login for simplicity
        }
        
        // Send password reset email
        function sendPasswordReset() {
            const email = document.getElementById('forgotEmail').value.trim();
            
            if (!email) {
                showError({ message: "Lütfen e-posta adresinizi girin" });
                return;
            }
            
            auth.sendPasswordResetEmail(email, {
                url: window.location.href,
                handleCodeInApp: true
            })
                .then(() => {
                    showSuccess("Şifre sıfırlama bağlantısı e-postanıza gönderildi. Lütfen e-postanızı kontrol edin.");
                    switchTab('login');
                })
                .catch((error) => {
                    showError(error, "Password Reset");
                });
        }
        
        // Check email verification status
        function checkEmailVerification() {
            auth.currentUser.reload().then(() => {
                if (auth.currentUser.emailVerified) {
                    showApp();
                    loadUserData(auth.currentUser);
                    showSuccess("E-posta doğrulama başarılı!");
                } else {
                    showError({ message: "E-postanız henüz doğrulanmadı. Lütfen e-postanızı kontrol edin ve doğrulama bağlantısına tıklayın." });
                }
            }).catch(error => {
                showError(error, "Email Verification Check");
            });
        }
        
        // Resend verification email
        function resendVerificationEmail() {
            auth.currentUser.sendEmailVerification({
                url: window.location.href,
                handleCodeInApp: true
            })
                .then(() => {
                    showSuccess("Doğrulama bağlantısı tekrar gönderildi. Lütfen e-postanızı kontrol edin.");
                })
                .catch((error) => {
                    showError(error, "Resend Verification");
                });
        }
        
        function logout() {
            auth.signOut().then(() => {
                showSuccess("Başarıyla çıkış yapıldı.");
                // Hide settings and show chat container
                document.getElementById('settingsContainer').style.display = 'none';
                document.getElementById('chatContainer').style.display = 'flex';
            }).catch(error => {
                showError(error, "Logout");
            });
            toggleDropdown();
        }
        
        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.user-avatar')) {
                const dropdowns = document.getElementsByClassName("dropdown-menu");
                for (let i = 0; i < dropdowns.length; i++) {
                    const openDropdown = dropdowns[i];
                    if (openDropdown.classList.contains('show')) {
                        openDropdown.classList.remove('show');
                    }
                }
            }
        }
    </script>
</body>
</html>

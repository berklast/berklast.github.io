<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
İsteğiniz üzerine, bana gönderdiğiniz **message.txt** dosyasının tüm içeriğini, herhangi bir eksiltme yapmadan aşağıda paylaşıyorum.

Bu, bir HTML, CSS ve JavaScript (Firebase ile) içeren, tam bir "MetinPro Ultimate | Premium Online Metin Düzenleyici" uygulamasının kodudur.

```html
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MetinPro Ultimate | Premium Online Metin Düzenleyici</title>
    <link rel="stylesheet" href="[https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css](https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css)">
    <link href="[https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap](https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap)" rel="stylesheet">
    <script src="[https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js](https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js)"></script>
    <script src="[https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js](https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js)"></script>
    <script src="[https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js](https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js)"></script>
    <style>
        /* === ROOT DEĞİŞKENLERİ === */
        :root {
            /* Renk Paleti */
            --primary: #6C63FF;
            --primary-dark: #564FD8;
            --primary-darker: #453FB5;
            --primary-light: #8B7FF0;
            --primary-lighter: #A89FF5;
            --primary-soft: #F0EEFF;
            
            --secondary: #FF6584;
            --secondary-dark: #E04A6D;
            --secondary-light: #FF8BA0;
            --secondary-soft: #FFEEF2;
            
            --success: #4ECDC4;
            --success-dark: #3AA8A0;
            --success-light: #7AE2DB;
            --success-soft: #EBF9F8;
            
            --warning: #FFD166;
            --warning-dark: #E6B952;
            --warning-light: #FFE4A3;
            --warning-soft: #FFF9EB;
            
            --danger: #EF476F;
            --danger-dark: #D43A5D;
            --danger-light: #F57E9B;
            --danger-soft: #FDEEF2;
            
            --info: #4895EF;
            --info-dark: #3A7BC8;
            --info-light: #7BB4F5;
            --info-soft: #EBF3FE;
            
            /* Nötr Renkler */
            --dark: #2A2D43;
            --darker: #1E2030;
            --darkest: #151623;
            
            --light: #F7F9FC;
            --lighter: #FFFFFF;
            --lightest: #FAFBFF;
            
            --gray-100: #F8F9FA;
            --gray-200: #E9ECEF;
            --gray-300: #DEE2E6;
            --gray-400: #CED4DA;
            --gray-500: #A0A7C2;
            --gray-600: #6C7383;
            --gray-700: #495057;
            --gray-800: #343A40;
            --gray-900: #212529;
            
            /* Metin Renkleri */
            --text: #2A2D43;
            --text-light: #6C7383;
            --text-lighter: #A0A7C2;
            --text-inverse: #FFFFFF;
            
            /* Arkaplanlar */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F7F9FC;
            --bg-tertiary: #F0F2F5;
            
            /* Gölgeler */
            --shadow-xs: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.08);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 6px 12px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.18);
            --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.25);
            --shadow-inner: inset 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-primary: 0 4px 14px rgba(108, 99, 255, 0.3);
            --shadow-primary-lg: 0 10px 30px rgba(108, 99, 255, 0.4);
            
            /* Gradyanlar */
            --gradient-primary: linear-gradient(135deg, #6C63FF 0%, #8B7FF0 100%);
            --gradient-primary-dark: linear-gradient(135deg, #564FD8 0%, #6C63FF 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6584 0%, #FF8BA0 100%);
            --gradient-success: linear-gradient(135deg, #4ECDC4 0%, #7AE2DB 100%);
            --gradient-warning: linear-gradient(135deg, #FFD166 0%, #FFE4A3 100%);
            --gradient-danger: linear-gradient(135deg, #EF476F 0%, #F57E9B 100%);
            --gradient-info: linear-gradient(135deg, #4895EF 0%, #7BB4F5 100%);
            --gradient-dark: linear-gradient(135deg, #2A2D43 0%, #1E2030 100%);
            --gradient-light: linear-gradient(135deg, #F7F9FC 0%, #FFFFFF 100%);
            
            /* Animasyonlar */
            --transition-fast: all 0.15s ease;
            --transition: all 0.3s ease;
            --transition-slow: all 0.5s ease;
            --transition-bounce: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --transition-smooth: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            
            /* Kenar Yuvarlaklıkları */
            --radius-none: 0;
            --radius-sm: 4px;
            --radius: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-3xl: 32px;
            --radius-full: 9999px;
            
            /* Boyutlar */
            --header-height: 70px;
            --sidebar-width: 320px;
            --sidebar-width-collapsed: 80px;
            --max-content-width: 1400px;
            
            /* Z-index */
            --z-dropdown: 1000;
            --z-sticky: 1020;
            --z-fixed: 1030;
            --z-modal-backdrop: 1040;
            --z-modal: 1050;
            --z-popover: 1060;
            --z-tooltip: 1070;
            --z-toast: 1080;
            --z-splash: 9999;
        }

        /* === DARK MODE === */
        .dark-mode {
            --bg-primary: #1E2030;
            --bg-secondary: #2A2D43;
            --bg-tertiary: #343853;
            
            --text: #F7F9FC;
            --text-light: #A0A7C2;
            --text-lighter: #6C7383;
            --text-inverse: #2A2D43;
            
            --gray-100: #2A2D43;
            --gray-200: #343853;
            --gray-300: #3E425F;
            --gray-400: #49516F;
            --gray-500: #6C7383;
            --gray-600: #A0A7C2;
            --gray-700: #CED4DA;
            --gray-800: #E9ECEF;
            --gray-900: #F8F9FA;
            
            --light: #1E2030;
            --lighter: #2A2D43;
            --lightest: #343853;
            
            --shadow-xs: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.35);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 6px 12px rgba(0, 0, 0, 0.45);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.5);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.55);
            --shadow-2xl: 0 25px 50px rgba(0, 0, 0, 0.6);
            --shadow-inner: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* === GENEL STİLLER === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-secondary);
            color: var(--text);
            line-height: 1.6;
            font-weight: 400;
            min-height: 100vh;
            transition: var(--transition-slow);
            overflow-x: hidden;
        }

        /* === TYPOGRAPHY === */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; }
        h3 { font-size: 1.75rem; }
        h4 { font-size: 1.5rem; }
        h5 { font-size: 1.25rem; }
        h6 { font-size: 1rem; }

        p {
            margin-bottom: 1rem;
        }

        a {
            color: var(--primary);
            text-decoration: none;
            transition: var(--transition);
        }

        a:hover {
            color: var(--primary-dark);
        }

        /* === LAYOUT === */
        .container {
            max-width: var(--max-content-width);
            margin: 0 auto;
            padding: 0 20px;
        }

        .container-fluid {
            width: 100%;
            padding: 0 20px;
        }

        /* === SPLASH SCREEN === */
        #splashScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: var(--z-splash);
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .splash-content {
            text-align: center;
            color: white;
            animation: fadeInUp 1s ease;
        }

        .splash-logo {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite, float 6s ease-in-out infinite;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.2));
        }

        .splash-text {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            letter-spacing: 2px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .splash-subtext {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 3rem;
            font-weight: 300;
        }

        .loading-container {
            width: 300px;
            margin: 0 auto;
        }

        .loading-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
            overflow: hidden;
            position: relative;
        }

        .loading-progress {
            height: 100%;
            width: 0%;
            background: white;
            border-radius: var(--radius-full);
            animation: loading 3s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .loading-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                -45deg, 
                rgba(255, 255, 255, 0.2) 25%, 
                transparent 25%, 
                transparent 50%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0.2) 75%, 
                transparent 75%, 
                transparent
            );
            background-size: 50px 50px;
            animation: move 2s linear infinite;
            border-radius: var(--radius-full);
        }

        .loading-text {
            color: white;
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* === AUTH CONTAINER === */
        .auth-container {
            display: flex;
            min-height: 100vh;
            border-radius: var(--radius-2xl);
            overflow: hidden;
            box-shadow: var(--shadow-2xl);
            margin: 20px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 1s ease 0.5s forwards;
        }

        .welcome-section {
            flex: 1;
            background: var(--gradient-primary);
            color: white;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 15s infinite linear;
        }

        .shape-1 {
            width: 100px;
            height: 100px;
            background: white;
            border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
            top: 10%;
            left: 10%;
            animation-duration: 20s;
        }

        .shape-2 {
            width: 150px;
            height: 150px;
            background: white;
            border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
            bottom: 10%;
            right: 10%;
            animation-duration: 25s;
            animation-direction: reverse;
        }

        .shape-3 {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 80%;
            animation-duration: 18s;
        }

        .welcome-content {
            position: relative;
            z-index: 1;
            max-width: 500px;
        }

        .welcome-logo {
            font-size: 3.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .welcome-logo i {
            margin-right: 15px;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.2));
        }

        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: 800;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
            font-weight: 300;
        }

        .features {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 40px;
        }

        .feature {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: var(--radius-lg);
            backdrop-filter: blur(10px);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .feature i {
            font-size: 1.5rem;
            margin-right: 10px;
            color: white;
        }

        .feature span {
            color: white;
            font-weight: 500;
        }

        .form-section {
            flex: 1;
            padding: 60px 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: var(--bg-primary);
            position: relative;
        }

        .form-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .form-title {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 800;
            position: relative;
            display: inline-block;
        }

        .form-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--primary);
            border-radius: var(--radius-full);
        }

        .form-subtitle {
            color: var(--text-light);
            margin-bottom: 30px;
            font-weight: 400;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            transition: var(--transition);
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            transition: var(--transition);
            z-index: 1;
        }

        .form-control {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--bg-primary);
            color: var(--text);
            font-weight: 500;
            position: relative;
            z-index: 0;
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
            outline: none;
        }

        .form-control:focus + .input-icon {
            color: var(--primary);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        /* === BUTTONS === */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 15px 24px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            width: 100%;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-primary);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition-slow);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-primary-lg);
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-success {
            background: var(--gradient-success);
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 10px 20px rgba(78, 205, 196, 0.4);
        }

        .btn-danger {
            background: var(--gradient-danger);
            box-shadow: 0 4px 15px rgba(239, 71, 111, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(239, 71, 111, 0.4);
        }

        .btn-warning {
            background: var(--gradient-warning);
            box-shadow: 0 4px 15px rgba(255, 209, 102, 0.3);
            color: var(--dark);
        }

        .btn-warning:hover {
            box-shadow: 0 10px 20px rgba(255, 209, 102, 0.4);
        }

        .btn-info {
            background: var(--gradient-info);
            box-shadow: 0 4px 15px rgba(72, 149, 239, 0.3);
        }

        .btn-info:hover {
            box-shadow: 0 10px 20px rgba(72, 149, 239, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: none;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-primary);
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 0.9rem;
        }

        .btn-lg {
            padding: 18px 28px;
            font-size: 1.1rem;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: var(--radius-full);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-loading {
            pointer-events: none;
            opacity: 0.8;
        }

        .btn-loading .btn-text {
            visibility: hidden;
        }

        .btn-loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .switch-form {
            text-align: center;
            margin-top: 20px;
        }

        .switch-form a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            position: relative;
        }

        .switch-form a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: var(--transition);
        }

        .switch-form a:hover::after {
            width: 100%;
        }

        /* === ALERTS & NOTIFICATIONS === */
        .alert {
            padding: 15px;
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            display: none;
            position: relative;
            overflow: hidden;
            border-left: 4px solid transparent;
            animation: slideInRight 0.5s ease;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }

        .alert-success {
            background: var(--success-soft);
            color: var(--success-dark);
            border-left-color: var(--success);
        }

        .alert-danger {
            background: var(--danger-soft);
            color: var(--danger-dark);
            border-left-color: var(--danger);
        }

        .alert-warning {
            background: var(--warning-soft);
            color: var(--warning-dark);
            border-left-color: var(--warning);
        }

        .alert-info {
            background: var(--info-soft);
            color: var(--info-dark);
            border-left-color: var(--info);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: var(--bg-primary);
            color: var(--text);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: var(--z-toast);
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 4px solid var(--primary);
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--danger);
        }

        .notification.warning {
            border-left-color: var(--warning);
        }

        .notification.info {
            border-left-color: var(--info);
        }

        /* === APP CONTAINER === */
        .app-container {
            display: none;
            min-height: 100vh;
            flex-direction: column;
        }

        /* === HEADER === */
        .header {
            background: var(--bg-primary);
            color: var(--text);
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            backdrop-filter: blur(10px);
            height: var(--header-height);
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            color: var(--primary);
        }

        .logo i {
            margin-right: 10px;
            animation: spin 20s linear infinite;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
        }

        .theme-toggle:hover {
            color: var(--primary);
            transform: rotate(30deg);
            background: var(--primary-soft);
        }

        .user-info {
            display: flex;
            align-items: center;
            background: var(--bg-secondary);
            padding: 8px 15px;
            border-radius: var(--radius-full);
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            cursor: pointer;
        }

        .user-info:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 10px;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
            box-shadow: var(--shadow-primary);
        }

        .user-name {
            font-weight: 600;
            margin-right: 10px;
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logout-btn:hover {
            color: var(--danger);
            background: var(--danger-soft);
            transform: rotate(15deg);
        }

        /* === MAIN CONTENT === */
        .main-content {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--header-height));
        }

        /* === SIDEBAR === */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-primary);
            padding: 25px;
            border-right: 1px solid var(--gray-200);
            overflow-y: auto;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
        }

        .sidebar-section {
            margin-bottom: 30px;
        }

        .sidebar-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: flex;
            align-items: center;
        }

        .sidebar-title i {
            margin-right: 10px;
        }

        .online-users {
            list-style: none;
        }

        .online-user {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            transition: var(--transition);
            animation: fadeIn 0.5s ease;
            border-left: 4px solid var(--success);
            box-shadow: var(--shadow-xs);
        }

        .online-user:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .user-status {
            width: 12px;
            height: 12px;
            border-radius: var(--radius-full);
            background: var(--success);
            margin-right: 10px;
            position: relative;
        }

        .user-status::after {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: var(--radius-full);
            background: var(--success);
            opacity: 0.4;
            animation: pulse 2s infinite;
        }

        .documents-list {
            list-style: none;
            flex: 1;
            overflow-y: auto;
        }

        .document-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            transition: var(--transition);
            cursor: pointer;
            border-left: 4px solid transparent;
            box-shadow: var(--shadow-xs);
        }

        .document-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
            border-left-color: var(--primary);
        }

        .document-item.active {
            background: var(--primary);
            color: white;
            border-left-color: var(--secondary);
            box-shadow: var(--shadow-primary);
        }

        .document-info {
            flex: 1;
        }

        .document-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .document-meta {
            font-size: 0.8rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
        }

        .document-item.active .document-meta {
            color: rgba(255, 255, 255, 0.8);
        }

        .document-actions {
            display: flex;
            opacity: 0;
            transition: var(--transition);
        }

        .document-item:hover .document-actions {
            opacity: 1;
        }

        .document-actions button {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            margin-left: 10px;
            transition: var(--transition);
            width: 30px;
            height: 30px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .document-item.active .document-actions button {
            color: white;
        }

        .document-actions button:hover {
            color: var(--danger);
            transform: scale(1.2);
            background: var(--danger-soft);
        }

        /* === CONTENT AREA === */
        .content-area {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .toolbar:hover {
            box-shadow: var(--shadow-lg);
        }

        .document-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .document-title i {
            margin-right: 10px;
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: var(--transition);
        }

        .editor-container:hover {
            box-shadow: var(--shadow-lg);
        }

        .editor-header {
            padding: 15px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .current-editors {
            display: flex;
            align-items: center;
        }

        .editor-badges {
            display: flex;
            margin-left: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }

        .editor-badge {
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            animation: pulse 2s infinite;
            box-shadow: var(--shadow-primary);
        }

        .editor-badge i {
            margin-right: 5px;
        }

        .editor {
            flex: 1;
            padding: 25px;
            border: none;
            outline: none;
            resize: none;
            font-size: 1rem;
            line-height: 1.6;
            font-family: 'Courier New', monospace;
            background: var(--bg-primary);
            color: var(--text);
            transition: var(--transition);
        }

        .editor:focus {
            box-shadow: inset 0 0 0 2px var(--primary);
        }

        .editor-stats {
            padding: 10px 20px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            color: var(--text-light);
            animation: fadeIn 1s ease;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.5;
            animation: pulse 3s infinite;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text);
        }

        .empty-state p {
            max-width: 400px;
            line-height: 1.6;
        }

        /* === MODALS === */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: var(--z-modal);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            width: 90%;
            max-width: 500px;
            animation: slideUp 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--gradient-primary);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
            width: 35px;
            height: 35px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-modal:hover {
            color: var(--danger);
            background: var(--danger-soft);
            transform: rotate(90deg);
        }

        .confirmation-modal .modal-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            gap: 10px;
        }

        /* === ANIMATIONS === */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(108, 99, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0); }
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(20px, 30px) rotate(10deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        @keyframes move {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }

        /* === MEDIA QUERIES (RESPONSIVE) === */
        @media (max-width: 1200px) {
            .sidebar {
                width: 280px;
                padding: 20px;
            }
            .content-area {
                padding: 20px;
            }
            .header {
                padding: 0 20px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: var(--header-height);
                height: calc(100vh - var(--header-height));
                z-index: var(--z-fixed);
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            .sidebar.open {
                transform: translateX(0);
            }
            .main-content {
                position: relative;
            }
            .main-content.sidebar-open::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.3);
                z-index: calc(var(--z-fixed) - 1);
            }
            .menu-toggle {
                display: block !important;
            }
            .welcome-section {
                display: none;
            }
            .auth-container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
                box-shadow: none;
            }
            .form-section {
                padding: 40px 20px;
            }
            .form-container {
                max-width: none;
            }
            .splash-logo {
                font-size: 4rem;
            }
            .splash-text {
                font-size: 2rem;
            }
            .splash-subtext {
                font-size: 1rem;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 15px;
            }
            .logo {
                font-size: 1.5rem;
            }
            .user-name {
                display: none;
            }
            .user-info {
                padding: 5px;
            }
            .user-avatar {
                margin-right: 0;
            }
            .toolbar {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
                padding: 15px;
            }
            .document-title {
                font-size: 1.2rem;
            }
            .toolbar-actions {
                width: 100%;
                justify-content: space-between;
            }
            .editor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .editor-badges {
                margin-left: 0;
            }
            .editor {
                padding: 15px;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                display: block;
            }
            .welcome-section {
                display: none;
            }
            .form-section {
                padding: 20px;
            }
            .modal-content {
                padding: 20px;
            }
            .features {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <button class="btn btn-icon menu-toggle" id="menuToggle" style="display: none; background: var(--bg-secondary); color: var(--primary);"><i class="fas fa-bars"></i></button>

<div class="auth-container" id="authContainer">
    <section class="welcome-section">
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
        <div class="welcome-content">
            <div class="welcome-logo">
                <i class="fas fa-file-code"></i>
                <span class="welcome-title">MetinPro</span>
            </div>
            <h2 class="welcome-subtitle">
                Eşzamanlı, Güvenli ve Özelleştirilebilir Çevrimiçi Metin Düzenleyici.
            </h2>
            <p>
                Hesabınıza giriş yaparak veya yeni bir hesap oluşturarak belgelerinizi bulutta düzenlemeye başlayın.
            </p>

            <div class="features">
                <div class="feature">
                    <i class="fas fa-users"></i>
                    <span>Eşzamanlı Düzenleme</span>
                </div>
                <div class="feature">
                    <i class="fas fa-lock"></i>
                    <span>Uçtan Uca Şifreleme</span>
                </div>
                <div class="feature">
                    <i class="fas fa-cogs"></i>
                    <span>Gelişmiş Özelleştirme</span>
                </div>
                <div class="feature">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Bulut Depolama</span>
                </div>
            </div>
        </div>
    </section>

    <section class="form-section">
        <div class="form-container">
            <form id="loginForm">
                <h2 class="form-title">Giriş Yap</h2>
                <p class="form-subtitle">Lütfen hesabınıza erişmek için bilgilerinizi girin.</p>
                
                <div id="loginAlert" class="alert alert-danger" role="alert"></div>

                <div class="form-group">
                    <label for="loginEmail">E-posta Adresi</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" class="form-control" id="loginEmail" required placeholder="ornek@mail.com">
                    </div>
                </div>

                <div class="form-group">
                    <label for="loginPassword">Şifre</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" class="form-control" id="loginPassword" required placeholder="Şifreniz">
                        <button type="button" class="password-toggle" data-target="loginPassword">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group" style="text-align: right;">
                    <a href="#" id="forgotPasswordLink">Şifremi Unuttum</a>
                </div>

                <button type="submit" class="btn" id="loginBtn">
                    <span class="btn-text">Giriş Yap</span>
                </button>

                <div class="switch-form">
                    <p>Hesabın yok mu? <a href="#" id="showRegister">Kayıt Ol</a></p>
                </div>
            </form>

            <form id="registerForm" style="display: none;">
                <h2 class="form-title">Kayıt Ol</h2>
                <p class="form-subtitle">Hemen bir hesap oluştur ve düzenlemeye başla.</p>
                
                <div id="registerAlert" class="alert alert-danger" role="alert"></div>

                <div class="form-group">
                    <label for="registerName">Adınız & Soyadınız</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" class="form-control" id="registerName" required placeholder="Adınız Soyadınız">
                    </div>
                </div>

                <div class="form-group">
                    <label for="registerEmail">E-posta Adresi</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" class="form-control" id="registerEmail" required placeholder="ornek@mail.com">
                    </div>
                </div>

                <div class="form-group">
                    <label for="registerPassword">Şifre (Min. 6 Karakter)</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" class="form-control" id="registerPassword" required placeholder="Güçlü bir şifre belirleyin">
                        <button type="button" class="password-toggle" data-target="registerPassword">
                            <i class="fas fa-eye-slash"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success" id="registerBtn">
                    <span class="btn-text">Hesap Oluştur</span>
                </button>

                <div class="switch-form">
                    <p>Zaten bir hesabın var mı? <a href="#" id="showLogin">Giriş Yap</a></p>
                </div>
            </form>

            <form id="resetPasswordForm" style="display: none;">
                <h2 class="form-title">Şifre Sıfırla</h2>
                <p class="form-subtitle">Hesabınızla ilişkili e-posta adresinizi girin, size bir sıfırlama bağlantısı göndereceğiz.</p>
                
                <div id="resetAlert" class="alert alert-danger" role="alert"></div>

                <div class="form-group">
                    <label for="resetEmail">E-posta Adresi</label>
                    <div class="input-with-icon">
                        <i class="fas fa-envelope input-icon"></i>
                        <input type="email" class="form-control" id="resetEmail" required placeholder="ornek@mail.com">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-warning" id="resetPasswordBtn">
                    <span class="btn-text">Sıfırlama Bağlantısı Gönder</span>
                </button>

                <div class="switch-form">
                    <p><a href="#" id="backToLogin">Giriş Ekranına Dön</a></p>
                </div>
            </form>
        </div>
    </section>
</div>

<div class="app-container" id="appContainer">
    
    <header class="header">
        <div class="logo">
            <i class="fas fa-file-code"></i>
            <span>MetinPro</span>
        </div>
        <div class="nav-actions">
            <button class="btn btn-icon theme-toggle" id="settingsBtn" title="Ayarlar">
                <i class="fas fa-cog"></i>
            </button>
            
            <button class="btn btn-icon theme-toggle" id="themeToggleBtn" title="Temayı Değiştir">
                <i class="fas fa-sun" id="themeIcon"></i>
            </button>
            
            <div class="user-info dropdown" id="userInfo">
                <div class="user-avatar" id="userAvatar">U</div>
                <span class="user-name" id="displayUserName">Kullanıcı</span>
                <i class="fas fa-caret-down"></i>
                
                <div class="dropdown-menu" id="userDropdown">
                    <a href="#" id="logoutDropdownLink" class="dropdown-item">
                        <i class="fas fa-sign-out-alt"></i> Çıkış Yap
                    </a>
                </div>
            </div>
            
            <button class="btn btn-sm btn-success" id="newDocumentBtn">
                <i class="fas fa-plus"></i> Yeni Doküman
            </button>
        </div>
    </header>

    <div class="main-content" id="mainContent">
        
        <aside class="sidebar" id="sidebar">
            
            <div class="sidebar-section">
                <h4 class="sidebar-title"><i class="fas fa-search"></i> Doküman Ara</h4>
                <div class="form-group">
                    <div class="input-with-icon">
                        <i class="fas fa-search input-icon"></i>
                        <input type="text" class="form-control" id="documentSearch" placeholder="Dokümanlarda ara...">
                    </div>
                </div>
            </div>

            <div class="sidebar-section" style="flex: 1; overflow-y: hidden;">
                <h4 class="sidebar-title"><i class="fas fa-file-alt"></i> Dokümanlarım</h4>
                <ul class="documents-list" id="documentsList">
                    <li class="document-item empty-state-list" style="display: none;">
                        <div class="document-info">
                            <div class="document-name">Henüz dokümanınız yok.</div>
                            <div class="document-meta">Yeni bir tane oluşturun!</div>
                        </div>
                    </li>
                </ul>
            </div>
            
            <div class="sidebar-section">
                <h4 class="sidebar-title"><i class="fas fa-users"></i> Çevrimiçi Kullanıcılar (<span id="onlineUserCount">0</span>)</h4>
                <ul class="online-users" id="onlineUsersList">
                    </ul>
            </div>
            
        </aside>

        <main class="content-area" id="contentArea">
            
            <div class="toolbar" id="documentToolbar" style="display: none;">
                <h2 class="document-title">
                    <i class="fas fa-pencil-alt"></i> 
                    <span id="currentDocumentName">Doküman Başlığı</span>
                </h2>
                <div class="toolbar-actions">
                    <button class="btn btn-sm btn-info" id="focusModeBtn" title="Odak Modu (Ctrl+F/Cmd+F)">
                        <i class="fas fa-crosshairs"></i> <span class="btn-text">Odak Modu</span>
                    </button>
                    <button class="btn btn-sm btn-primary" id="saveDocumentBtn" title="Kaydet (Ctrl+S/Cmd+S)">
                        <i class="fas fa-save"></i> <span class="btn-text">Kaydet</span>
                    </button>
                    <button class="btn btn-sm btn-danger" id="deleteDocumentBtn" title="Sil">
                        <i class="fas fa-trash-alt"></i> <span class="btn-text">Sil</span>
                    </button>
                </div>
            </div>

            <div class="editor-container" id="editorContainer">
                
                <div class="editor-header" id="editorHeader" style="display: none;">
                    <span id="documentStatus" class="document-status" style="font-weight: 600; color: var(--success);"><i class="fas fa-check-circle"></i> Kaydedildi</span>
                    <div class="current-editors">
                        Şu An Düzenleyenler:
                        <div class="editor-badges" id="documentEditors">
                            </div>
                    </div>
                </div>

                <textarea class="editor" id="documentEditor" placeholder="Lütfen soldan bir doküman seçin veya yeni bir doküman oluşturun."></textarea>
                
                <div class="editor-stats" id="editorStats" style="display: none;">
                    <span>Kelime Sayısı: <span id="wordCount">0</span></span>
                    <span>Karakter Sayısı: <span id="charCount">0</span></span>
                    <span>Satır Sayısı: <span id="lineCount">1</span></span>
                </div>
                
                <div class="empty-state" id="emptyState" style="display: flex;">
                    <i class="fas fa-file-code"></i>
                    <h3>MetinPro Ultimate'a Hoş Geldiniz!</h3>
                    <p>
                        Başlamak için soldan bir doküman seçin veya 'Yeni Doküman' butonuna tıklayarak ilk dokümanınızı oluşturun.
                    </p>
                    <button class="btn btn-sm btn-primary" id="emptyStateNewDocumentBtn" style="width: auto; margin-top: 15px;">
                        <i class="fas fa-plus"></i> Yeni Doküman Oluştur
                    </button>
                </div>

            </div>

        </main>

    </div>

</div>

<div id="notificationContainer">
    </div>

<div id="newDocumentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-file-alt"></i> Yeni Doküman Oluştur</h3>
            <button class="close-modal" id="closeNewDocumentModal"><i class="fas fa-times"></i></button>
        </div>
        <form id="newDocumentForm">
            <div class="form-group">
                <label for="newDocumentName">Doküman Adı</label>
                <div class="input-with-icon">
                    <i class="fas fa-signature input-icon"></i>
                    <input type="text" class="form-control" id="newDocumentName" required placeholder="Dokümanınızın adını girin">
                </div>
            </div>
            <div class="form-group">
                <label for="newDocumentContent">Başlangıç İçeriği (İsteğe Bağlı)</label>
                <textarea class="form-control" id="newDocumentContent" rows="5" placeholder="İsteğe bağlı başlangıç metnini buraya girin..."></textarea>
            </div>
            <button type="submit" class="btn btn-primary" id="createDocumentBtn">
                <span class="btn-text">Oluştur ve Düzenlemeye Başla</span>
            </button>
        </form>
    </div>
</div>

<div id="deleteConfirmationModal" class="modal confirmation-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Dokümanı Sil</h3>
            <button class="close-modal" id="closeDeleteConfirmationModal"><i class="fas fa-times"></i></button>
        </div>
        <p>
            **<span id="deleteDocumentNamePlaceholder" style="font-weight: 600;">[Doküman Adı]</span>** adlı dokümanı kalıcı olarak silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
        </p>
        <div class="modal-actions">
            <button class="btn btn-outline btn-sm" id="cancelDeleteBtn">İptal</button>
            <button class="btn btn-danger btn-sm" id="confirmDeleteBtn">Evet, Sil</button>
        </div>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title"><i class="fas fa-cog"></i> Uygulama Ayarları</h3>
            <button class="close-modal" id="closeSettingsModal"><i class="fas fa-times"></i></button>
        </div>
        <form id="settingsForm">
            <h4 style="margin-top: 0; color: var(--primary);"><i class="fas fa-palette"></i> Tema</h4>
            <div class="form-group">
                <label>Renk Teması</label>
                <div style="display: flex; gap: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="radio" name="colorTheme" value="light" id="lightThemeRadio" checked>
                        <span style="margin-left: 8px;">Aydınlık</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="radio" name="colorTheme" value="dark" id="darkThemeRadio">
                        <span style="margin-left: 8px;">Karanlık</span>
                    </label>
                </div>
            </div>
            
            <h4 style="margin-top: 25px; color: var(--primary);"><i class="fas fa-font"></i> Editör Ayarları</h4>
            <div class="form-group">
                <label for="fontSize">Yazı Tipi Boyutu</label>
                <select class="form-control" id="fontSize">
                    <option value="0.9rem">Küçük (0.9rem)</option>
                    <option value="1rem" selected>Orta (1.0rem)</option>
                    <option value="1.1rem">Büyük (1.1rem)</option>
                    <option value="1.2rem">Çok Büyük (1.2rem)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="fontFamily">Yazı Tipi</label>
                <select class="form-control" id="fontFamily">
                    <option value="'Courier New', monospace" selected>Monospace (Varsayılan)</option>
                    <option value="'Poppins', sans-serif">Poppins (Sans-serif)</option>
                    <option value="'Roboto', sans-serif">Roboto (Sans-serif)</option>
                    <option value="'Merriweather', serif">Merriweather (Serif)</option>
                </select>
            </div>

            <h4 style="margin-top: 25px; color: var(--primary);"><i class="fas fa-magic"></i> Gelişmiş</h4>
            <div class="form-group">
                <label>Otomatik Kaydetme</label>
                <div style="display: flex; align-items: center;">
                    <label class="switch">
                        <input type="checkbox" id="autoSaveToggle" checked>
                        <span class="slider round"></span>
                    </label>
                    <span style="margin-left: 15px; font-size: 0.9rem; color: var(--text-light);" id="autoSaveStatus">Açık</span>
                </div>
            </div>
            
            <button type="submit" class="btn btn-info" id="saveSettingsBtn" style="margin-top: 20px;">
                <span class="btn-text"><i class="fas fa-check"></i> Ayarları Kaydet</span>
            </button>
        </form>
    </div>
</div>

</head>
<body>
<script>
    // === CONSTANTS & CONFIG ===
    const FIREBASE_CONFIG = {
        apiKey: "YOUR_API_KEY", // Replace with your Firebase API Key
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(FIREBASE_CONFIG);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // === DOM ELEMENTS ===
    const splashScreen = document.getElementById('splashScreen');
    const authContainer = document.getElementById('authContainer');
    const appContainer = document.getElementById('appContainer');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const resetPasswordForm = document.getElementById('resetPasswordForm');
    const loginAlert = document.getElementById('loginAlert');
    const registerAlert = document.getElementById('registerAlert');
    const resetAlert = document.getElementById('resetAlert');
    const showRegisterLink = document.getElementById('showRegister');
    const showLoginLink = document.getElementById('showLogin');
    const forgotPasswordLink = document.getElementById('forgotPasswordLink');
    const backToLoginLink = document.getElementById('backToLogin');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const themeIcon = document.getElementById('themeIcon');
    const displayUserName = document.getElementById('displayUserName');
    const userAvatar = document.getElementById('userAvatar');
    const logoutDropdownLink = document.getElementById('logoutDropdownLink');
    const userInfoDropdown = document.getElementById('userDropdown');
    const documentsList = document.getElementById('documentsList');
    const documentEditor = document.getElementById('documentEditor');
    const emptyState = document.getElementById('emptyState');
    const contentArea = document.getElementById('contentArea');
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menuToggle');
    const mainContent = document.getElementById('mainContent');
    const newDocumentBtn = document.getElementById('newDocumentBtn');
    const emptyStateNewDocumentBtn = document.getElementById('emptyStateNewDocumentBtn');
    const newDocumentModal = document.getElementById('newDocumentModal');
    const newDocumentForm = document.getElementById('newDocumentForm');
    const closeNewDocumentModal = document.getElementById('closeNewDocumentModal');
    const newDocumentNameInput = document.getElementById('newDocumentName');
    const newDocumentContentInput = document.getElementById('newDocumentContent');
    const currentDocumentName = document.getElementById('currentDocumentName');
    const documentToolbar = document.getElementById('documentToolbar');
    const saveDocumentBtn = document.getElementById('saveDocumentBtn');
    const deleteDocumentBtn = document.getElementById('deleteDocumentBtn');
    const deleteConfirmationModal = document.getElementById('deleteConfirmationModal');
    const closeDeleteConfirmationModal = document.getElementById('closeDeleteConfirmationModal');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    const deleteDocumentNamePlaceholder = document.getElementById('deleteDocumentNamePlaceholder');
    const onlineUsersList = document.getElementById('onlineUsersList');
    const onlineUserCount = document.getElementById('onlineUserCount');
    const editorHeader = document.getElementById('editorHeader');
    const documentStatus = document.getElementById('documentStatus');
    const documentEditorsContainer = document.getElementById('documentEditors');
    const documentSearchInput = document.getElementById('documentSearch');
    const editorStats = document.getElementById('editorStats');
    const wordCountSpan = document.getElementById('wordCount');
    const charCountSpan = document.getElementById('charCount');
    const lineCountSpan = document.getElementById('lineCount');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeSettingsModal = document.getElementById('closeSettingsModal');
    const settingsForm = document.getElementById('settingsForm');
    const lightThemeRadio = document.getElementById('lightThemeRadio');
    const darkThemeRadio = document.getElementById('darkThemeRadio');
    const fontSizeSelect = document.getElementById('fontSize');
    const fontFamilySelect = document.getElementById('fontFamily');
    const autoSaveToggle = document.getElementById('autoSaveToggle');
    const autoSaveStatusSpan = document.getElementById('autoSaveStatus');
    const focusModeBtn = document.getElementById('focusModeBtn');

    // === STATE ===
    let currentUser = null;
    let currentDocumentId = null;
    let autoSaveTimeout = null;
    let documentRef = null;
    let documentUnsubscribe = null;
    let presenceRef = null;
    let presenceUnsubscribe = null;
    let usersRef = null;
    let usersUnsubscribe = null;
    let isFocusMode = false;
    let themeSetting = localStorage.getItem('theme') || 'light';
    let settings = JSON.parse(localStorage.getItem('editorSettings')) || {
        fontSize: '1rem',
        fontFamily: "'Courier New', monospace",
        autoSave: true
    };
    let lastSavedContent = '';

    // === UTILITY FUNCTIONS ===

    /**
     * Shows a custom notification toast.
     * @param {string} message The message to display.
     * @param {('success'|'error'|'warning'|'info')} type The type of notification.
     */
    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <i class="fas ${getIconForType(type)}"></i>
            <span>${message}</span>
        `;

        // Add to DOM and show
        container.appendChild(notification);
        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        // Auto-hide after 5 seconds
        setTimeout(() => {
            notification.classList.remove('show');
            // Remove from DOM after transition
            notification.addEventListener('transitionend', () => {
                notification.remove();
            });
        }, 5000);
    }
    
    /**
     * Gets the Font Awesome icon class for a notification type.
     * @param {string} type The notification type.
     * @returns {string} The icon class.
     */
    function getIconForType(type) {
        switch (type) {
            case 'success': return 'fa-check-circle';
            case 'error': return 'fa-times-circle';
            case 'warning': return 'fa-exclamation-triangle';
            case 'info': return 'fa-info-circle';
            default: return 'fa-bell';
        }
    }

    /**
     * Shows an alert message within a form.
     * @param {HTMLElement} alertElement The div element to show the alert in.
     * @param {string} message The message to display.
     * @param {('success'|'danger'|'warning'|'info')} type The alert type.
     */
    function showAlert(alertElement, message, type = 'danger') {
        alertElement.className = `alert alert-${type}`;
        alertElement.innerHTML = message;
        alertElement.style.display = 'block';
    }

    /**
     * Hides an alert message.
     * @param {HTMLElement} alertElement The div element to hide.
     */
    function hideAlert(alertElement) {
        alertElement.style.display = 'none';
    }

    /**
     * Toggles the visibility of password inputs.
     * @param {string} targetId The ID of the password input.
     * @param {HTMLElement} toggleButton The button element.
     */
    function togglePasswordVisibility(targetId, toggleButton) {
        const targetInput = document.getElementById(targetId);
        const icon = toggleButton.querySelector('i');

        if (targetInput.type === 'password') {
            targetInput.type = 'text';
            icon.className = 'fas fa-eye';
        } else {
            targetInput.type = 'password';
            icon.className = 'fas fa-eye-slash';
        }
    }

    // Event listener for password toggles
    document.querySelectorAll('.password-toggle').forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.getAttribute('data-target');
            togglePasswordVisibility(targetId, button);
        });
    });
    
    /**
     * Toggles the loading state of a button.
     * @param {HTMLElement} button The button element.
     * @param {boolean} isLoading Whether to set loading state.
     */
    function toggleButtonLoading(button, isLoading) {
        if (isLoading) {
            button.classList.add('btn-loading');
            button.setAttribute('disabled', 'disabled');
        } else {
            button.classList.remove('btn-loading');
            button.removeAttribute('disabled');
        }
    }

    /**
     * Toggles between Login and Register forms.
     * @param {string} formToShow 'login', 'register', or 'reset'.
     */
    function switchAuthForm(formToShow) {
        loginForm.style.display = 'none';
        registerForm.style.display = 'none';
        resetPasswordForm.style.display = 'none';
        
        hideAlert(loginAlert);
        hideAlert(registerAlert);
        hideAlert(resetAlert);
        
        if (formToShow === 'register') {
            registerForm.style.display = 'block';
        } else if (formToShow === 'reset') {
            resetPasswordForm.style.display = 'block';
        } else { // default to login
            loginForm.style.display = 'block';
        }
    }

    // Form switching listeners
    showRegisterLink.addEventListener('click', (e) => {
        e.preventDefault();
        switchAuthForm('register');
    });

    showLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        switchAuthForm('login');
    });

    forgotPasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        switchAuthForm('reset');
    });

    backToLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        switchAuthForm('login');
    });
    
    /**
     * Handles user registration.
     */
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const name = document.getElementById('registerName').value;
        const registerBtn = document.getElementById('registerBtn');
        
        hideAlert(registerAlert);
        toggleButtonLoading(registerBtn, true);

        try {
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Update user profile and create Firestore user document
            await Promise.all([
                user.updateProfile({
                    displayName: name
                }),
                db.collection('users').doc(user.uid).set({
                    uid: user.uid,
                    displayName: name,
                    email: email,
                    avatarInitial: name.charAt(0).toUpperCase(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                })
            ]);

            showNotification('Kayıt başarılı! Giriş yapılıyor...', 'success');
            // authStateChanged handle app UI change
        } catch (error) {
            console.error("Kayıt Hatası:", error);
            let message = "Kayıt olurken bir hata oluştu. Lütfen tekrar deneyin.";
            if (error.code === 'auth/email-already-in-use') {
                message = "Bu e-posta adresi zaten kullanımda.";
            } else if (error.code === 'auth/invalid-email') {
                message = "Geçersiz e-posta adresi.";
            } else if (error.code === 'auth/weak-password') {
                message = "Şifre en az 6 karakter olmalıdır.";
            }
            showAlert(registerAlert, message);
        } finally {
            toggleButtonLoading(registerBtn, false);
        }
    });

    /**
     * Handles user login.
     */
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const loginBtn = document.getElementById('loginBtn');
        
        hideAlert(loginAlert);
        toggleButtonLoading(loginBtn, true);

        try {
            const userCredential = await auth.signInWithEmailAndPassword(email, password);
            
            // Update last login timestamp
            await db.collection('users').doc(userCredential.user.uid).update({
                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            });
            
            showNotification('Giriş başarılı!', 'success');
            // authStateChanged handle app UI change
        } catch (error) {
            console.error("Giriş Hatası:", error);
            let message = "E-posta veya şifreniz hatalı. Lütfen kontrol edin.";
            if (error.code === 'auth/user-not-found') {
                message = "Kullanıcı bulunamadı.";
            } else if (error.code === 'auth/wrong-password') {
                message = "Şifre hatalı.";
            }
            showAlert(loginAlert, message);
        } finally {
            toggleButtonLoading(loginBtn, false);
        }
    });

    /**
     * Handles password reset.
     */
    resetPasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('resetEmail').value;
        const resetPasswordBtn = document.getElementById('resetPasswordBtn');

        hideAlert(resetAlert);
        toggleButtonLoading(resetPasswordBtn, true);

        try {
            await auth.sendPasswordResetEmail(email);
            showAlert(resetAlert, `Şifre sıfırlama bağlantısı ${email} adresine gönderildi. Lütfen e-postanızı kontrol edin.`, 'success');
        } catch (error) {
            console.error("Şifre Sıfırlama Hatası:", error);
            let message = "Şifre sıfırlanırken bir hata oluştu. E-posta adresinizi kontrol edin.";
            if (error.code === 'auth/user-not-found') {
                message = "Bu e-posta adresiyle kayıtlı bir kullanıcı bulunamadı.";
            }
            showAlert(resetAlert, message);
        } finally {
            toggleButtonLoading(resetPasswordBtn, false);
        }
    });

    /**
     * Handles user logout.
     */
    function handleLogout() {
        auth.signOut().then(() => {
            showNotification('Başarıyla çıkış yaptınız.', 'info');
        }).catch((error) => {
            console.error("Çıkış Hatası:", error);
            showNotification('Çıkış yapılırken bir hata oluştu.', 'error');
        });
    }

    // Logout listeners
    logoutDropdownLink.addEventListener('click', handleLogout);
    
    // === UI INITIALIZATION AND THEME HANDLING ===

    /**
     * Handles the initial app load, displaying splash screen and checking auth state.
     */
    function initApp() {
        // Simulating a load delay for the splash screen effect
        setTimeout(() => {
            splashScreen.style.opacity = '0';
            splashScreen.style.visibility = 'hidden';
            
            // Check auth state immediately after splash screen is gone
            if (auth.currentUser) {
                // If already logged in, show app container immediately.
                authContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                // Trigger an initial auth state change to set up the app UI
                onAuthStateChangedHandler(auth.currentUser); 
            } else {
                // Show auth container if not logged in
                authContainer.style.display = 'flex';
                appContainer.style.display = 'none';
            }
        }, 3500); // Duration matches loading animation + fade out

        // Apply theme settings on startup
        applyTheme(themeSetting);
        applyEditorSettings(settings);
    }

    /**
     * Applies the selected theme (light/dark) to the document.
     * @param {string} theme 'light' or 'dark'.
     */
    function applyTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            themeIcon.className = 'fas fa-moon';
            themeToggleBtn.setAttribute('title', 'Aydınlık Temaya Geç');
        } else {
            document.body.classList.remove('dark-mode');
            themeIcon.className = 'fas fa-sun';
            themeToggleBtn.setAttribute('title', 'Karanlık Temaya Geç');
        }
        themeSetting = theme;
        localStorage.setItem('theme', theme);
    }

    /**
     * Toggles the theme between light and dark.
     */
    themeToggleBtn.addEventListener('click', () => {
        const newTheme = themeSetting === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
    });
    
    /**
     * Handles the dropdown menu visibility for user info.
     */
    document.getElementById('userInfo').addEventListener('click', (e) => {
        // Prevent click from bubbling up and closing immediately
        e.stopPropagation(); 
        userInfoDropdown.style.display = userInfoDropdown.style.display === 'block' ? 'none' : 'block';
    });

    // Close dropdown when clicking anywhere else
    document.addEventListener('click', () => {
        userInfoDropdown.style.display = 'none';
    });
    
    // Theme switch for login/register modal to use on settings modal.
    document.getElementById('lightThemeRadio').addEventListener('change', (e) => {
        if (e.target.checked) applyTheme('light');
    });
    document.getElementById('darkThemeRadio').addEventListener('change', (e) => {
        if (e.target.checked) applyTheme('dark');
    });

    // === EDITOR & DOCUMENT FUNCTIONS ===

    /**
     * Updates character, word, and line counts in the editor stats.
     */
    function updateStats() {
        const text = documentEditor.value;
        const charCount = text.length;
        const wordCount = text.trim().split(/\s+/).filter(word => word.length > 0).length;
        const lineCount = text.split('\n').length;

        wordCountSpan.textContent = wordCount;
        charCountSpan.textContent = charCount;
        lineCountSpan.textContent = lineCount;
    }

    /**
     * Handles editor input events for auto-save and stats.
     */
    documentEditor.addEventListener('input', () => {
        updateStats();
        
        // Update document status
        documentStatus.innerHTML = '<i class="fas fa-edit"></i> Değişiklikler var...';
        documentStatus.style.color = 'var(--warning-dark)';
        
        // Auto-save logic
        if (settings.autoSave && currentDocumentId) {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                saveDocument(currentDocumentId, documentEditor.value, true);
            }, 3000); // Save after 3 seconds of inactivity
        }
    });

    /**
     * Creates a new document in Firestore.
     */
    newDocumentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = newDocumentNameInput.value.trim();
        const content = newDocumentContentInput.value;
        const createDocumentBtn = document.getElementById('createDocumentBtn');

        if (!name) {
            showNotification('Doküman adı boş olamaz.', 'warning');
            return;
        }
        
        toggleButtonLoading(createDocumentBtn, true);

        try {
            const newDocRef = await db.collection('documents').add({
                name: name,
                content: content,
                ownerId: currentUser.uid,
                ownerName: currentUser.displayName,
                lastModifiedBy: currentUser.displayName,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                editorIds: [currentUser.uid], // Initial editor
                isPublic: false // Default to private
            });
            
            showNotification(`'${name}' başarıyla oluşturuldu!`, 'success');
            
            // Immediately open the new document
            await openDocument(newDocRef.id, name, content);

            // Close modal and clear form
            newDocumentModal.style.display = 'none';
            newDocumentNameInput.value = '';
            newDocumentContentInput.value = '';

        } catch (error) {
            console.error("Doküman Oluşturma Hatası:", error);
            showNotification('Doküman oluşturulurken bir hata oluştu.', 'error');
        } finally {
            toggleButtonLoading(createDocumentBtn, false);
        }
    });
    
    // New Document Modal open/close listeners
    [newDocumentBtn, emptyStateNewDocumentBtn].forEach(btn => {
        btn.addEventListener('click', () => {
            newDocumentModal.style.display = 'flex';
            if (newDocumentNameInput) newDocumentNameInput.focus();
        });
    });
    closeNewDocumentModal.addEventListener('click', () => {
        newDocumentModal.style.display = 'none';
    });
    
    // Close modal when clicking outside
    newDocumentModal.addEventListener('click', (e) => {
        if (e.target === newDocumentModal) {
            newDocumentModal.style.display = 'none';
        }
    });

    /**
     * Saves the current document content to Firestore.
     * @param {string} docId The ID of the document.
     * @param {string} content The new content to save.
     * @param {boolean} isAutoSave Whether the save was triggered automatically.
     */
    async function saveDocument(docId, content, isAutoSave = false) {
        if (!docId) return;

        // Check if content has changed since last save/load
        if (content === lastSavedContent) {
            if (!isAutoSave) {
                 showNotification('Dokümanda yeni bir değişiklik yok.', 'info');
            }
            return;
        }
        
        const saveBtn = document.getElementById('saveDocumentBtn');
        const originalText = saveBtn.querySelector('.btn-text').textContent;
        
        // Show saving state on button
        if (!isAutoSave) {
            saveBtn.querySelector('.btn-text').textContent = 'Kaydediliyor...';
            toggleButtonLoading(saveBtn, true);
        }

        try {
            await db.collection('documents').doc(docId).update({
                content: content,
                lastModifiedBy: currentUser.displayName,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            lastSavedContent = content; // Update last saved content
            
            // Update document status to saved
            documentStatus.innerHTML = '<i class="fas fa-check-circle"></i> Kaydedildi';
            documentStatus.style.color = 'var(--success-dark)';
            
            if (!isAutoSave) {
                showNotification('Doküman başarıyla kaydedildi!', 'success');
            }
        } catch (error) {
            console.error("Doküman Kaydetme Hatası:", error);
            showNotification('Doküman kaydedilirken bir hata oluştu.', 'error');
        } finally {
            // Restore button state
            if (!isAutoSave) {
                saveBtn.querySelector('.btn-text').textContent = originalText;
                toggleButtonLoading(saveBtn, false);
            }
        }
    }
    
    saveDocumentBtn.addEventListener('click', () => {
        if (currentDocumentId) {
            saveDocument(currentDocumentId, documentEditor.value, false);
        }
    });

    /**
     * Handles the logic for opening a document.
     * @param {string} docId The ID of the document to open.
     * @param {string} docName The name of the document.
     * @param {string} docContent The initial content of the document.
     */
    async function openDocument(docId, docName, docContent) {
        // 1. Close existing listeners
        if (documentUnsubscribe) documentUnsubscribe();
        if (presenceUnsubscribe) presenceUnsubscribe();
        
        // 2. Update current state and UI elements
        currentDocumentId = docId;
        currentDocumentName.textContent = docName;
        documentEditor.value = docContent || '';
        lastSavedContent = docContent || ''; // Set initial saved content
        
        // Activate UI elements
        emptyState.style.display = 'none';
        documentToolbar.style.display = 'flex';
        editorHeader.style.display = 'flex';
        editorStats.style.display = 'flex';
        documentEditor.removeAttribute('disabled');
        documentEditor.focus();
        
        // Highlight active document in sidebar
        document.querySelectorAll('.document-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.id === docId) {
                item.classList.add('active');
            }
        });

        // Update stats immediately
        updateStats();
        
        // 3. Set up Real-time Document Listener
        documentRef = db.collection('documents').doc(docId);
        documentUnsubscribe = documentRef.onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                
                // Update name if changed by another user
                if (currentDocumentName.textContent !== data.name) {
                    currentDocumentName.textContent = data.name;
                }
                
                // Update editor content if change is not local
                const currentCursorPos = documentEditor.selectionStart;
                const localContent = documentEditor.value;
                if (data.content !== localContent) {
                    // Update content and maintain cursor position
                    const diff = data.content.length - localContent.length;
                    documentEditor.value = data.content;
                    documentEditor.selectionStart = documentEditor.selectionEnd = currentCursorPos + diff;
                    lastSavedContent = data.content;
                    updateStats();
                    documentStatus.innerHTML = `<i class="fas fa-cloud-download-alt"></i> Güncellendi (${data.lastModifiedBy})`;
                    documentStatus.style.color = 'var(--primary-dark)';
                } else {
                    // Content is the same (local changes match remote save)
                    if (documentStatus.innerHTML.includes('Değişiklikler')) {
                        documentStatus.innerHTML = '<i class="fas fa-check-circle"></i> Kaydedildi';
                        documentStatus.style.color = 'var(--success-dark)';
                    }
                }
                
                // Update editor badges
                updateDocumentEditors(data.editorIds || []);

            } else {
                // Document was deleted
                closeDocument();
                showNotification('Açık olan doküman silinmiş.', 'error');
            }
        }, (error) => {
            console.error("Doküman dinlenirken hata:", error);
            showNotification('Doküman güncellemeleri alınırken hata oluştu.', 'error');
        });
        
        // 4. Set up Real-time Presence (Other Editors)
        // Add current user to editorIds array (if not present) and set up presence
        await documentRef.update({
            editorIds: firebase.firestore.FieldValue.arrayUnion(currentUser.uid)
        });
        
        // Set up presence removal when user navigates away or logs out
        presenceRef = db.collection('documents').doc(docId);
        window.onbeforeunload = () => {
             // For reliable presence, use onDisconnect on the Realtime Database (more complex to set up)
             // For now, this arrayRemove covers normal navigations and logouts.
             if (presenceRef) {
                 presenceRef.update({
                     editorIds: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
                 });
             }
        };
        
        // 5. Update browser URL (optional, but good practice)
        // history.pushState(null, '', `?docId=${docId}`);
    }
    
    /**
     * Updates the list of current editors for a document.
     * @param {string[]} editorIds Array of UIDs of users currently editing.
     */
    function updateDocumentEditors(editorIds) {
        documentEditorsContainer.innerHTML = ''; // Clear previous badges
        
        // Remove current user's ID from list for display
        const otherEditorIds = editorIds.filter(id => id !== currentUser.uid);

        if (otherEditorIds.length === 0) {
             documentEditorsContainer.innerHTML = '<span class="editor-badge" style="background: var(--gray-500);"><i class="fas fa-user-lock"></i> Yalnızsınız</span>';
             return;
        }

        // Fetch user details for the IDs
        otherEditorIds.forEach(editorId => {
            db.collection('users').doc(editorId).get().then(doc => {
                if (doc.exists) {
                    const userData = doc.data();
                    const badge = document.createElement('span');
                    badge.className = 'editor-badge';
                    badge.style.background = getRandomColor(userData.displayName || 'Anonim');
                    badge.innerHTML = `<i class="fas fa-user-edit"></i> ${userData.displayName || 'Anonim'}`;
                    documentEditorsContainer.appendChild(badge);
                }
            });
        });
    }

    /**
     * Gets a stable, random color for a given string (name).
     * @param {string} str The input string.
     * @returns {string} A CSS color string.
     */
    function getRandomColor(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
        }
        let color = '#';
        for (let i = 0; i < 3; i++) {
            let value = (hash >> (i * 8)) & 0xFF;
            color += ('00' + value.toString(16)).substr(-2);
        }
        return color;
    }

    /**
     * Clears the editor and resets the UI to the empty state.
     */
    async function closeDocument() {
        if (documentUnsubscribe) documentUnsubscribe();
        if (presenceUnsubscribe) presenceUnsubscribe();
        clearTimeout(autoSaveTimeout);
        
        // Remove user from document's editorIds array
        if (currentDocumentId && currentUser) {
            await db.collection('documents').doc(currentDocumentId).update({
                editorIds: firebase.firestore.FieldValue.arrayRemove(currentUser.uid)
            }).catch(e => console.error("Editor ID kaldırılamadı:", e));
        }

        currentDocumentId = null;
        documentRef = null;
        lastSavedContent = '';
        
        documentEditor.value = '';
        documentEditor.setAttribute('disabled', 'disabled');
        documentToolbar.style.display = 'none';
        editorHeader.style.display = 'none';
        editorStats.style.display = 'none';
        emptyState.style.display = 'flex';
        documentEditorsContainer.innerHTML = '';
        
        document.querySelectorAll('.document-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Remove focus mode if active
        if (isFocusMode) toggleFocusMode();
        
        // history.pushState(null, '', window.location.pathname);
    }
    
    /**
     * Deletes the currently open document.
     */
    deleteDocumentBtn.addEventListener('click', () => {
        if (currentDocumentId) {
            // Show confirmation modal
            deleteDocumentNamePlaceholder.textContent = currentDocumentName.textContent;
            deleteConfirmationModal.style.display = 'flex';
        }
    });

    // Delete Confirmation Modal open/close listeners
    closeDeleteConfirmationModal.addEventListener('click', () => {
        deleteConfirmationModal.style.display = 'none';
    });
    cancelDeleteBtn.addEventListener('click', () => {
        deleteConfirmationModal.style.display = 'none';
    });
    deleteConfirmationModal.addEventListener('click', (e) => {
        if (e.target === deleteConfirmationModal) {
            deleteConfirmationModal.style.display = 'none';
        }
    });
    
    // Confirm Delete Action
    confirmDeleteBtn.addEventListener('click', async () => {
        const docIdToDelete = currentDocumentId;
        const docNameToDelete = currentDocumentName.textContent;
        
        toggleButtonLoading(confirmDeleteBtn, true);

        try {
            // Document listener will automatically close the document after deletion
            await db.collection('documents').doc(docIdToDelete).delete();
            
            showNotification(`'${docNameToDelete}' başarıyla silindi.`, 'danger');
            deleteConfirmationModal.style.display = 'none';
        } catch (error) {
            console.error("Doküman Silme Hatası:", error);
            showNotification('Doküman silinirken bir hata oluştu.', 'error');
        } finally {
            toggleButtonLoading(confirmDeleteBtn, false);
        }
    });
    
    /**
     * Retrieves and displays the user's list of documents.
     */
    function loadDocuments() {
        const userId = currentUser.uid;
        const documentsRef = db.collection('documents').where('ownerId', '==', userId).orderBy('updatedAt', 'desc');

        // Unsubscribe from previous listener if any
        if (window.documentListUnsubscribe) window.documentListUnsubscribe();

        window.documentListUnsubscribe = documentsRef.onSnapshot((snapshot) => {
            documentsList.innerHTML = ''; // Clear existing list
            
            const docs = [];
            snapshot.forEach(doc => {
                docs.push({ id: doc.id, ...doc.data() });
            });
            
            if (docs.length === 0) {
                document.querySelector('.empty-state-list').style.display = 'block';
            } else {
                document.querySelector('.empty-state-list').style.display = 'none';
                docs.forEach(doc => {
                    const li = createDocumentListItem(doc);
                    documentsList.appendChild(li);
                });
            }
            
            // Re-apply active class
            if (currentDocumentId) {
                 document.querySelector(`.document-item[data-id="${currentDocumentId}"]`)?.classList.add('active');
            }

        }, (error) => {
            console.error("Doküman listesi dinlenirken hata:", error);
            showNotification('Doküman listesi yüklenirken hata oluştu.', 'error');
        });
    }

    /**
     * Creates a list item element for a document.
     * @param {object} doc Document data.
     * @returns {HTMLElement} The <li> element.
     */
    function createDocumentListItem(doc) {
        const li = document.createElement('li');
        li.className = 'document-item';
        li.dataset.id = doc.id;
        li.innerHTML = `
            <div class="document-info">
                <div class="document-name">${doc.name}</div>
                <div class="document-meta">
                    <i class="fas fa-clock"></i> 
                    <span>${formatDate(doc.updatedAt)}</span>
                    <i class="fas fa-user-edit" style="margin-left: 10px;"></i> 
                    <span>${doc.lastModifiedBy}</span>
                </div>
            </div>
            <div class="document-actions">
                <button class="btn-icon" data-action="rename" title="Yeniden Adlandır"><i class="fas fa-edit"></i></button>
                <button class="btn-icon" data-action="delete" title="Sil" style="color: var(--danger);"><i class="fas fa-trash-alt"></i></button>
            </div>
        `;
        
        li.addEventListener('click', (e) => {
            // Ignore clicks on action buttons
            if (e.target.closest('button')) return;
            
            // Open the document
            openDocument(doc.id, doc.name, doc.content);
        });
        
        // Action buttons listeners (Delegated approach is usually better, but this works for this scope)
        li.querySelector('[data-action="delete"]').addEventListener('click', (e) => {
            e.stopPropagation(); // Stop click from opening document
            // Set current document for modal and open
            currentDocumentId = doc.id;
            currentDocumentName.textContent = doc.name;
            deleteDocumentBtn.click();
        });
        
        li.querySelector('[data-action="rename"]').addEventListener('click', async (e) => {
            e.stopPropagation(); // Stop click from opening document
            const newName = prompt(`'${doc.name}' için yeni bir ad girin:`, doc.name);
            if (newName && newName.trim() !== doc.name) {
                try {
                    await db.collection('documents').doc(doc.id).update({
                        name: newName.trim(),
                        lastModifiedBy: currentUser.displayName,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    showNotification('Doküman adı güncellendi.', 'success');
                } catch (error) {
                    console.error("Yeniden Adlandırma Hatası:", error);
                    showNotification('Yeniden adlandırma başarısız oldu.', 'error');
                }
            }
        });

        return li;
    }
    
    /**
     * Formats a Firebase timestamp into a human-readable relative time.
     * @param {firebase.firestore.Timestamp} timestamp The timestamp object.
     * @returns {string} The formatted date string.
     */
    function formatDate(timestamp) {
        if (!timestamp || !timestamp.toDate) return 'Bilinmiyor';
        
        const date = timestamp.toDate();
        const now = new Date();
        const diff = now.getTime() - date.getTime();
        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        if (seconds < 60) return 'şimdi';
        if (minutes < 60) return `${minutes} dk önce`;
        if (hours < 24) return `${hours} saat önce`;
        if (days < 7) return `${days} gün önce`;
        
        // Fallback to absolute date
        return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    /**
     * Filters the document list based on search input.
     */
    documentSearchInput.addEventListener('input', () => {
        const searchTerm = documentSearchInput.value.toLowerCase().trim();
        document.querySelectorAll('.document-item').forEach(item => {
            const docName = item.querySelector('.document-name').textContent.toLowerCase();
            if (docName.includes(searchTerm)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    });

    // === ONLINE USERS (PRESENCE) ===

    /**
     * Retrieves and displays the list of online users.
     */
    function loadOnlineUsers() {
        // This is a simple implementation of presence. 
        // A more robust solution involves Firebase Realtime Database and setting user status.
        
        const oneMinuteAgo = new Date(Date.now() - 60000);
        
        // This query is slow and not ideal for real-time presence. 
        // It fetches ALL users and filters by lastLogin (which is updated on sign in).
        // For a proper solution, a separate "presence" collection updated frequently 
        // or Firebase Realtime Database should be used.
        usersRef = db.collection('users').where('lastLogin', '>', oneMinuteAgo).orderBy('lastLogin', 'desc');

        // Unsubscribe from previous listener if any
        if (window.usersListUnsubscribe) window.usersListUnsubscribe();

        // Use a less frequent listener or rely on a simpler 'documentEditors' approach
        // since Firestore is not optimized for massive, rapid updates like presence.
        
        // Placeholder implementation based on simple, currently logged-in users (not truly 'online')
        // For a real-time app, this should be improved.
        onlineUsersList.innerHTML = '';
        onlineUserCount.textContent = '1'; // Just the current user
        
        const li = document.createElement('li');
        li.className = 'online-user';
        li.innerHTML = `
            <div class="user-status"></div>
            <span>${currentUser.displayName || 'Anonim Kullanıcı'} (Siz)</span>
        `;
        onlineUsersList.appendChild(li);
    }
    
    // === SETTINGS MODAL ===

    /**
     * Opens the settings modal and loads current settings.
     */
    function openSettings() {
        // Load current settings into form elements
        if (themeSetting === 'light') {
            lightThemeRadio.checked = true;
        } else {
            darkThemeRadio.checked = true;
        }
        
        fontSizeSelect.value = settings.fontSize;
        fontFamilySelect.value = settings.fontFamily;
        
        autoSaveToggle.checked = settings.autoSave;
        autoSaveStatusSpan.textContent = settings.autoSave ? 'Açık' : 'Kapalı';
        
        settingsModal.style.display = 'flex';
    }

    // Settings listeners
    settingsBtn.addEventListener('click', openSettings);
    closeSettingsModal.addEventListener('click', () => {
        settingsModal.style.display = 'none';
    });
    settingsModal.addEventListener('click', (e) => {
        if (e.target === settingsModal) {
            settingsModal.style.display = 'none';
        }
    });

    // Auto Save Toggle Listener
    autoSaveToggle.addEventListener('change', () => {
        autoSaveStatusSpan.textContent = autoSaveToggle.checked ? 'Açık' : 'Kapalı';
    });

    /**
     * Saves and applies the editor settings.
     */
    settingsForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const newSettings = {
            fontSize: fontSizeSelect.value,
            fontFamily: fontFamilySelect.value,
            autoSave: autoSaveToggle.checked
        };
        
        // Save to local storage
        localStorage.setItem('editorSettings', JSON.stringify(newSettings));
        
        // Apply to editor
        applyEditorSettings(newSettings);
        
        showNotification('Ayarlar başarıyla kaydedildi.', 'success');
        settingsModal.style.display = 'none';
    });

    /**
     * Applies the saved settings to the document editor.
     * @param {object} newSettings The settings object.
     */
    function applyEditorSettings(newSettings) {
        settings = newSettings;
        documentEditor.style.fontSize = settings.fontSize;
        documentEditor.style.fontFamily = settings.fontFamily;
    }
    
    // === FOCUS MODE ===
    
    /**
     * Toggles the focus mode, which hides the sidebar and expands the editor.
     */
    function toggleFocusMode() {
        isFocusMode = !isFocusMode;
        
        if (isFocusMode) {
            sidebar.style.display = 'none';
            mainContent.classList.add('focus-mode');
            focusModeBtn.classList.add('btn-outline');
            focusModeBtn.querySelector('.btn-text').textContent = 'Odak Modundan Çık';
            showNotification('Odak Modu Açık: Tüm dikkat içeriğe.', 'info');
        } else {
            sidebar.style.display = 'flex';
            mainContent.classList.remove('focus-mode');
            focusModeBtn.classList.remove('btn-outline');
            focusModeBtn.querySelector('.btn-text').textContent = 'Odak Modu';
            showNotification('Odak Modu Kapalı.', 'info');
        }
    }
    
    focusModeBtn.addEventListener('click', toggleFocusMode);
    
    // Add CSS for Focus Mode (Dynamic since it's not in the main CSS)
    const styleSheet = document.createElement('style');
    styleSheet.innerHTML = `
        /* Focus Mode Styles */
        .main-content.focus-mode .content-area {
            width: 100%;
        }
        .main-content.focus-mode .editor-container {
            border-radius: var(--radius-lg);
        }
        
        @media (max-width: 992px) {
            .main-content.focus-mode .sidebar {
                display: none !important; /* Override mobile open/close */
            }
        }
    `;
    document.head.appendChild(styleSheet);


    // === AUTH STATE HANDLER ===

    /**
     * Global handler for Firebase Auth State changes.
     * @param {firebase.User} user The authenticated user object or null.
     */
    function onAuthStateChangedHandler(user) {
        currentUser = user;

        if (user) {
            // User is signed in
            
            // 1. Fetch the full user data from Firestore (needed for displayName)
            db.collection('users').doc(user.uid).get().then(doc => {
                const userData = doc.data();
                const displayName = userData?.displayName || user.email;
                
                // 2. Update UI for logged-in user
                displayUserName.textContent = displayName.split(' ')[0];
                userAvatar.textContent = (displayName.charAt(0) || 'U').toUpperCase();
                
                // 3. Switch UI from Auth to App
                authContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                
                // 4. Load application data
                loadDocuments();
                loadOnlineUsers();
                
            }).catch(error => {
                console.error("Kullanıcı verisi çekilemedi:", error);
                // Even if user data fails, proceed with basic user info
                displayUserName.textContent = (user.email.split('@')[0] || 'Kullanıcı');
                userAvatar.textContent = (user.email.charAt(0) || 'U').toUpperCase();
                
                authContainer.style.display = 'none';
                appContainer.style.display = 'flex';
                loadDocuments();
                loadOnlineUsers();
            });
            
            // Mobile Menu Toggle logic
            menuToggle.style.display = 'flex';
            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('open');
                mainContent.classList.toggle('sidebar-open');
            });

        } else {
            // User is signed out
            
            // 1. Clear document/presence listeners
            closeDocument();
            if (window.documentListUnsubscribe) window.documentListUnsubscribe();
            if (window.usersListUnsubscribe) window.usersListUnsubscribe();
            
            // 2. Reset UI
            appContainer.style.display = 'none';
            authContainer.style.display = 'flex';
            documentsList.innerHTML = '';
            onlineUsersList.innerHTML = '';
            onlineUserCount.textContent = '0';
            
            // Reset mobile menu state
            menuToggle.style.display = 'none';
            sidebar.classList.remove('open');
            mainContent.classList.remove('sidebar-open');
        }
    }

    // Listen for auth state changes
    auth.onAuthStateChanged(onAuthStateChangedHandler);

    // Initialize the app after all functions are defined
    initApp();
    
    
    // === KEYBOARD SHORTCUTS ===
    document.addEventListener('keydown', (e) => {
        // Ctrl+S veya Cmd+S - Kaydet
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            if (currentDocumentId) {
                saveDocument(currentDocumentId, documentEditor.value);
                showNotification('Doküman kaydedildi', 'success');
            }
        }
        
        // Ctrl+N veya Cmd+N - Yeni doküman
        if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
            e.preventDefault();
            if (newDocumentModal) {
                newDocumentModal.style.display = 'flex';
                if (newDocumentNameInput) newDocumentNameInput.focus();
            }
        }
        
        // Ctrl+O veya Cmd+O - Ayarlar
        if ((e.ctrlKey || e.metaKey) && e.key === 'o') {
            e.preventDefault();
            openSettings();
        }
        
        // Ctrl+F veya Cmd+F - Odak modu
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
            e.preventDefault();
            if (currentDocumentId && focusModeBtn) {
                toggleFocusMode();
            }
        }
        
        // Escape - Odak modundan çık
        if (e.key === 'Escape' && isFocusMode) {
            e.preventDefault();
            toggleFocusMode();
        }
    });
</script>
</body>
</html>

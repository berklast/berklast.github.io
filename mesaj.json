function editMessage(messageId) {
    const messageRef = db.collection('chats').doc(currentChat).collection('messages').doc(messageId);
    
    messageRef.get().then(doc => {
        if (doc.exists) {
            const currentText = doc.data().text;
            const newText = prompt("Mesajı düzenle:", currentText);
            
            if (newText && newText !== currentText) {
                messageRef.update({
                    text: newText,
                    edited: true,
                    editedAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    // UI güncelleme
                    const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                    if (messageElement) {
                        messageElement.querySelector('.message-bubble').textContent = newText;
                        const timeElement = messageElement.querySelector('.message-time');
                        if (timeElement) {
                            timeElement.textContent = formatMessageTime(new Date()) + ' (düzenlendi)';
                        }
                    }
                }).catch(error => {
                    console.error("Error editing message:", error);
                    showError(error, "Edit Message");
                });
            }
        }
    });
}
